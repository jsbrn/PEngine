package gui;

import java.awt.Color;
import java.awt.Cursor;
import java.awt.Desktop;
import java.awt.Dialog;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Image;
import java.awt.Rectangle;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseWheelEvent;
import java.awt.event.MouseWheelListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.event.WindowFocusListener;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URI;
import java.net.URISyntaxException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Logger;
import javax.swing.BorderFactory;
import javax.swing.DefaultComboBoxModel;
import javax.swing.GroupLayout;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JColorChooser;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JToggleButton;
import javax.swing.KeyStroke;
import javax.swing.LayoutStyle;
import javax.swing.UIManager;
import javax.swing.WindowConstants;
import javax.swing.border.BevelBorder;
import misc.Assets;
import misc.MiscMath;
import misc.Types;
import project.objects.components.Animation;
import project.objects.components.Block;
import project.objects.components.Flow;
import threads.UpdateManager;
import project.Level;
import project.Project;
import project.objects.SceneObject;

public class GUI extends javax.swing.JFrame {

    static GUI window;

    /**
     * Creates new form First
     */
    public GUI() {
        initComponents();
    }
    
    @Override
    public List<Image> getIconImages() {
        ArrayList imageList = new ArrayList();
        imageList.add(new ImageIcon(getClass().getResource(
            "/assets/icon.png")).getImage());
        imageList.add(new ImageIcon(getClass().getResource(
            "/assets/icon32x32.png")).getImage());
        imageList.add(new ImageIcon(getClass().getResource(
            "/assets/icon16x16.png")).getImage());
        return imageList;
      }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        testOutputDialog = new JDialog();
        jScrollPane9 = new JScrollPane();
        resultsTextBox = new JTextArea();
        levelManagerDialog = new JDialog();
        deleteLevelButton = new JButton();
        editLevelButton = new JButton();
        renameLevelButton = new JButton();
        setHomeButton = new JButton();
        levelChooser = new JComboBox<>();
        objectEditor = new JFrame();
        galleryObjectPanel = new JPanel();
        galleryObjectChooser = new JComboBox<>();
        newGalleryObjectButton = new JButton();
        deleteGalleryObjectButton = new JButton();
        jLabel3 = new JLabel();
        jLabel4 = new JLabel();
        objectEditorTabs = new JTabbedPane();
        sceneObjectCanvas = new SceneObjectCanvas();
        basicOptionsPanel = new JPanel();
        objectGravityCheckbox = new JCheckBox();
        objectCollidesCheckbox = new JCheckBox();
        changeObjectTypeButton = new JButton();
        changeObjectNameButton = new JButton();
        changeObjectTextureButton = new JButton();
        objectTypeField = new JTextField();
        objectNameField = new JTextField();
        objectTextureField = new JTextField();
        lockTextureButton = new JToggleButton();
        lockGravityButton = new JToggleButton();
        lockCollidesButton = new JToggleButton();
        flowCanvas = new FlowCanvas();
        jPanel9 = new JPanel();
        flowChooser = new JComboBox<>();
        newFlowButton = new JButton();
        deleteFlowButton = new JButton();
        renameFlowButton = new JButton();
        lockFlowButton = new JToggleButton();
        addBlockButton = new JButton();
        deleteBlockButton = new JButton();
        jPanel7 = new JPanel();
        blockInputChooser = new JComboBox<>();
        setBlockInputValue = new JButton();
        jLabel6 = new JLabel();
        jLabel5 = new JLabel();
        blockOutputChooser = new JComboBox<>();
        setBlockOutputValue = new JButton();
        variablesPanel = new JPanel();
        jScrollPane1 = new JScrollPane();
        variablesList = new JList<>();
        jLabel7 = new JLabel();
        renameVariableButton = new JButton();
        valueTestPanel = new JPanel();
        jLabel8 = new JLabel();
        valueTestField = new JTextField();
        jButton1 = new JButton();
        animationCanvas = new AnimationCanvas();
        jPanel8 = new JPanel();
        animationChooser = new JComboBox<>();
        newAnimationButton = new JButton();
        deleteAnimationButton = new JButton();
        renameAnimationButton = new JButton();
        animationSpeedButton = new JButton();
        animationSpriteButton = new JButton();
        lockAnimationButton = new JToggleButton();
        jPanel6 = new JPanel();
        addFrameButton = new JButton();
        removeFrameButton = new JButton();
        playAnimationButton = new JToggleButton();
        frameCountLabel = new JLabel();
        sceneCanvas = new SceneCanvas();
        jPanel13 = new JPanel();
        playButton = new JButton();
        startAtCurrentLevelCheckBox = new JCheckBox();
        topPanel = new JPanel();
        bringForwardButton = new JButton();
        sendBackwardsButton = new JButton();
        cloneObjectButton = new JButton();
        editObjectButton = new JButton();
        objectLayerChooser = new JComboBox();
        newObjectButton = new JButton();
        jLabel1 = new JLabel();
        deleteObjectButton = new JButton();
        jPanel5 = new JPanel();
        jCheckBox1 = new JCheckBox();
        jLabel2 = new JLabel();
        menuBar = new JMenuBar();
        fileMenu = new JMenu();
        newProjectButton = new JMenuItem();
        openProjectButton = new JMenuItem();
        saveProjectButton = new JMenuItem();
        projectMenu = new JMenu();
        newLevelButton = new JMenuItem();
        levelManagerButton = new JMenuItem();
        jSeparator5 = new JPopupMenu.Separator();
        objectGalleryButton = new JMenuItem();
        jSeparator6 = new JPopupMenu.Separator();
        reloadAssetsButton = new JMenuItem();
        openAssetsFolderButton = new JMenuItem();
        jSeparator4 = new JPopupMenu.Separator();
        viewRootButton = new JMenuItem();
        levelMenu = new JMenu();
        spawnMenuItem = new JMenuItem();
        cameraLocationMenuItem = new JMenuItem();
        jMenuItem1 = new JMenuItem();
        levelBoundsMenuItem = new JMenuItem();
        jMenu2 = new JMenu();
        jMenuItem2 = new JMenuItem();
        topColorMenuItem = new JMenuItem();
        bottomColorMenuItem = new JMenuItem();
        jMenuItem10 = new JMenuItem();
        jMenuItem7 = new JMenuItem();
        lightingColorMenuItem = new JMenuItem();
        jMenuItem3 = new JMenuItem();
        jMenu1 = new JMenu();
        jMenuItem8 = new JMenuItem();
        selectBGMusic = new JMenuItem();
        loopBGMusicMenuItem = new JCheckBoxMenuItem();
        autoplayBGMusicMenuItem = new JCheckBoxMenuItem();
        musicVolumeMenuItem = new JMenuItem();
        jMenuItem9 = new JMenuItem();
        selectAmbienceMenuItem = new JMenuItem();
        loopAmbientSoundMenuItem = new JCheckBoxMenuItem();
        autoplayAmbientSoundMenuItem = new JCheckBoxMenuItem();
        ambientSoundVolumeMenuItem = new JMenuItem();
        jMenu3 = new JMenu();
        jMenuItem5 = new JMenuItem();
        jMenuItem6 = new JMenuItem();
        jMenuItem4 = new JMenuItem();
        statusIndicator = new JMenu();

        testOutputDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        testOutputDialog.setTitle("Game output");
        testOutputDialog.setBounds(new Rectangle(0, 0, 600, 490));
        testOutputDialog.setIconImage(null);
        testOutputDialog.setIconImages(getIconImages());
        testOutputDialog.setMinimumSize(new Dimension(400, 490));
        testOutputDialog.setModalExclusionType(Dialog.ModalExclusionType.APPLICATION_EXCLUDE);
        testOutputDialog.setResizable(false);
        testOutputDialog.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                genericDialogWindowClosing(evt);
            }
        });

        resultsTextBox.setColumns(20);
        resultsTextBox.setLineWrap(true);
        resultsTextBox.setRows(5);
        jScrollPane9.setViewportView(resultsTextBox);

        GroupLayout testOutputDialogLayout = new GroupLayout(testOutputDialog.getContentPane());
        testOutputDialog.getContentPane().setLayout(testOutputDialogLayout);
        testOutputDialogLayout.setHorizontalGroup(testOutputDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(testOutputDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane9, GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
                .addContainerGap())
        );
        testOutputDialogLayout.setVerticalGroup(testOutputDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(testOutputDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane9, GroupLayout.DEFAULT_SIZE, 416, Short.MAX_VALUE)
                .addContainerGap())
        );

        levelManagerDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        levelManagerDialog.setTitle("Choose a level...");
        levelManagerDialog.setBounds(new Rectangle(300, 300, 356, 130));
        levelManagerDialog.setIconImage(null);
        levelManagerDialog.setIconImages(getIconImages());
        levelManagerDialog.setModalExclusionType(Dialog.ModalExclusionType.APPLICATION_EXCLUDE);
        levelManagerDialog.setResizable(false);
        levelManagerDialog.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                genericDialogWindowClosing(evt);
            }
            public void windowOpened(WindowEvent evt) {
                levelManagerDialogWindowOpened(evt);
            }
        });

        deleteLevelButton.setText("Delete");
        deleteLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteLevelButtonActionPerformed(evt);
            }
        });

        editLevelButton.setText("Edit!");
        editLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                editLevelButtonActionPerformed(evt);
            }
        });

        renameLevelButton.setText("Rename...");
        renameLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameLevelButtonActionPerformed(evt);
            }
        });

        setHomeButton.setText("Set home");
        setHomeButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                setHomeButtonActionPerformed(evt);
            }
        });

        levelChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                levelChooserActionPerformed(evt);
            }
        });

        GroupLayout levelManagerDialogLayout = new GroupLayout(levelManagerDialog.getContentPane());
        levelManagerDialog.getContentPane().setLayout(levelManagerDialogLayout);
        levelManagerDialogLayout.setHorizontalGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(levelManagerDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(levelChooser, 0, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(levelManagerDialogLayout.createSequentialGroup()
                        .addComponent(editLevelButton, GroupLayout.DEFAULT_SIZE, 186, Short.MAX_VALUE)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING, false)
                            .addGroup(levelManagerDialogLayout.createSequentialGroup()
                                .addComponent(setHomeButton)
                                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(deleteLevelButton))
                            .addComponent(renameLevelButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addContainerGap())
        );
        levelManagerDialogLayout.setVerticalGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(levelManagerDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(levelChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING, false)
                    .addGroup(levelManagerDialogLayout.createSequentialGroup()
                        .addComponent(renameLevelButton)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                            .addComponent(deleteLevelButton)
                            .addComponent(setHomeButton)))
                    .addComponent(editLevelButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(56, Short.MAX_VALUE))
        );

        objectEditor.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        objectEditor.setBounds(new Rectangle(0, 0, 700, 500));
        objectEditor.setIconImages(getIconImages());
        objectEditor.setMinimumSize(new Dimension(700, 500));
        objectEditor.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                objectEditorWindowClosing(evt);
            }
        });

        galleryObjectPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        galleryObjectChooser.setModel(new DefaultComboBoxModel<>(new String[] { "Player" }));
        galleryObjectChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                galleryObjectChooserActionPerformed(evt);
            }
        });

        newGalleryObjectButton.setText("New object...");
        newGalleryObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newGalleryObjectButtonActionPerformed(evt);
            }
        });

        deleteGalleryObjectButton.setForeground(new Color(255, 0, 0));
        deleteGalleryObjectButton.setText("Delete object");
        deleteGalleryObjectButton.setEnabled(false);
        deleteGalleryObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteGalleryObjectButtonActionPerformed(evt);
            }
        });

        jLabel3.setText("Gallery object:");

        jLabel4.setFont(new Font("Tahoma", 1, 11)); // NOI18N
        jLabel4.setText("Object Gallery");

        GroupLayout galleryObjectPanelLayout = new GroupLayout(galleryObjectPanel);
        galleryObjectPanel.setLayout(galleryObjectPanelLayout);
        galleryObjectPanelLayout.setHorizontalGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(galleryObjectPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel4)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel3)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(galleryObjectChooser, GroupLayout.PREFERRED_SIZE, 235, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(newGalleryObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteGalleryObjectButton)
                .addContainerGap())
        );
        galleryObjectPanelLayout.setVerticalGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(galleryObjectPanelLayout.createSequentialGroup()
                .addGap(4, 4, 4)
                .addGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(galleryObjectChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(newGalleryObjectButton)
                    .addComponent(deleteGalleryObjectButton)
                    .addComponent(jLabel3)
                    .addComponent(jLabel4))
                .addGap(3, 3, 3))
        );

        basicOptionsPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        objectGravityCheckbox.setText("Gravity");
        objectGravityCheckbox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectGravityCheckboxActionPerformed(evt);
            }
        });

        objectCollidesCheckbox.setText("Collides");
        objectCollidesCheckbox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectCollidesCheckboxActionPerformed(evt);
            }
        });

        changeObjectTypeButton.setText("Change type...");
        changeObjectTypeButton.setActionCommand("c");
        changeObjectTypeButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        changeObjectNameButton.setText("Change name...");
        changeObjectNameButton.setActionCommand("n");
        changeObjectNameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        changeObjectTextureButton.setText("Change texture...");
        changeObjectTextureButton.setActionCommand("t");
        changeObjectTextureButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        objectTypeField.setEditable(false);

        objectNameField.setEditable(false);

        objectTextureField.setEditable(false);

        lockTextureButton.setIcon(new ImageIcon(getClass().getResource("/assets/lock.png"))); // NOI18N
        lockTextureButton.setActionCommand("0");
        lockTextureButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        lockGravityButton.setIcon(new ImageIcon(getClass().getResource("/assets/lock.png"))); // NOI18N
        lockGravityButton.setActionCommand("1");
        lockGravityButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        lockCollidesButton.setIcon(new ImageIcon(getClass().getResource("/assets/lock.png"))); // NOI18N
        lockCollidesButton.setActionCommand("2");
        lockCollidesButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        GroupLayout basicOptionsPanelLayout = new GroupLayout(basicOptionsPanel);
        basicOptionsPanel.setLayout(basicOptionsPanelLayout);
        basicOptionsPanelLayout.setHorizontalGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                        .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.TRAILING, false)
                            .addComponent(changeObjectTypeButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(changeObjectNameButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(changeObjectTextureButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.TRAILING, false)
                            .addComponent(objectNameField, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
                            .addComponent(objectTextureField)
                            .addComponent(objectTypeField, GroupLayout.Alignment.LEADING))
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockTextureButton))
                    .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                        .addGap(2, 2, 2)
                        .addComponent(objectGravityCheckbox)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockGravityButton)
                        .addGap(18, 18, 18)
                        .addComponent(objectCollidesCheckbox)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockCollidesButton)))
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        basicOptionsPanelLayout.setVerticalGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectTypeButton)
                    .addComponent(objectTypeField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectNameButton)
                    .addComponent(objectNameField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectTextureButton)
                    .addComponent(objectTextureField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(lockTextureButton, GroupLayout.PREFERRED_SIZE, 23, GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(lockCollidesButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                        .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING, false)
                            .addComponent(objectCollidesCheckbox, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(objectGravityCheckbox, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lockGravityButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );

        GroupLayout sceneObjectCanvasLayout = new GroupLayout(sceneObjectCanvas);
        sceneObjectCanvas.setLayout(sceneObjectCanvasLayout);
        sceneObjectCanvasLayout.setHorizontalGroup(sceneObjectCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneObjectCanvasLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(basicOptionsPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(385, Short.MAX_VALUE))
        );
        sceneObjectCanvasLayout.setVerticalGroup(sceneObjectCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneObjectCanvasLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(basicOptionsPanel, GroupLayout.PREFERRED_SIZE, 134, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(302, Short.MAX_VALUE))
        );

        objectEditorTabs.addTab("Basics", sceneObjectCanvas);

        flowCanvas.addMouseMotionListener(new MouseMotionAdapter() {
            public void mouseDragged(MouseEvent evt) {
                flowCanvasMouseDragged(evt);
            }
            public void mouseMoved(MouseEvent evt) {
                flowCanvasMouseMoved(evt);
            }
        });
        flowCanvas.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent evt) {
                flowCanvasMouseClicked(evt);
            }
        });

        flowChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                flowChooserActionPerformed(evt);
            }
        });

        newFlowButton.setText("New");
        newFlowButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newFlowButtonActionPerformed(evt);
            }
        });

        deleteFlowButton.setForeground(new Color(255, 0, 0));
        deleteFlowButton.setText("Delete");
        deleteFlowButton.setEnabled(false);
        deleteFlowButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteFlowButtonActionPerformed(evt);
            }
        });

        renameFlowButton.setText("Rename...");
        renameFlowButton.setEnabled(false);
        renameFlowButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameFlowButtonActionPerformed(evt);
            }
        });

        lockFlowButton.setIcon(new ImageIcon(getClass().getResource("/assets/lock.png"))); // NOI18N
        lockFlowButton.setActionCommand("f");
        lockFlowButton.setEnabled(false);
        lockFlowButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        addBlockButton.setMnemonic('b');
        addBlockButton.setText("Add block...");
        addBlockButton.setEnabled(false);
        addBlockButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                addBlockButtonActionPerformed(evt);
            }
        });

        deleteBlockButton.setText("Delete block");
        deleteBlockButton.setEnabled(false);
        deleteBlockButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteBlockButtonActionPerformed(evt);
            }
        });

        GroupLayout jPanel9Layout = new GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(jPanel9Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(newFlowButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(flowChooser, GroupLayout.PREFERRED_SIZE, 150, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lockFlowButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteFlowButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(renameFlowButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(addBlockButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteBlockButton)
                .addContainerGap(75, Short.MAX_VALUE))
        );
        jPanel9Layout.setVerticalGroup(jPanel9Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel9Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(flowChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(newFlowButton)
                    .addComponent(deleteFlowButton)
                    .addComponent(renameFlowButton)
                    .addComponent(lockFlowButton, GroupLayout.PREFERRED_SIZE, 23, GroupLayout.PREFERRED_SIZE)
                    .addComponent(addBlockButton)
                    .addComponent(deleteBlockButton))
                .addGap(5, 5, 5))
        );

        blockInputChooser.setModel(new DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        blockInputChooser.setEnabled(false);

        setBlockInputValue.setText("Set value...");
        setBlockInputValue.setActionCommand("i");
        setBlockInputValue.setEnabled(false);
        setBlockInputValue.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                setBlockInputValueActionPerformed(evt);
            }
        });

        jLabel6.setText("Input:");

        jLabel5.setText("Output:");

        blockOutputChooser.setModel(new DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        blockOutputChooser.setEnabled(false);

        setBlockOutputValue.setText("Set value...");
        setBlockOutputValue.setActionCommand("o");
        setBlockOutputValue.setEnabled(false);
        setBlockOutputValue.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                setBlockInputValueActionPerformed(evt);
            }
        });

        GroupLayout jPanel7Layout = new GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(jPanel7Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel6)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(blockInputChooser, GroupLayout.PREFERRED_SIZE, 150, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(setBlockInputValue)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel5)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(blockOutputChooser, GroupLayout.PREFERRED_SIZE, 150, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(setBlockOutputValue)
                .addContainerGap())
        );
        jPanel7Layout.setVerticalGroup(jPanel7Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel7Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(blockInputChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(setBlockInputValue)
                    .addComponent(jLabel5)
                    .addComponent(blockOutputChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(setBlockOutputValue))
                .addGap(5, 5, 5))
        );

        variablesPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        jScrollPane1.setViewportView(variablesList);

        jLabel7.setFont(new Font("Tahoma", 1, 11)); // NOI18N
        jLabel7.setText("Variables");

        renameVariableButton.setText("Edit...");
        renameVariableButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameVariableButtonActionPerformed(evt);
            }
        });

        GroupLayout variablesPanelLayout = new GroupLayout(variablesPanel);
        variablesPanel.setLayout(variablesPanelLayout);
        variablesPanelLayout.setHorizontalGroup(variablesPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(variablesPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(variablesPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addGroup(variablesPanelLayout.createSequentialGroup()
                        .addComponent(jLabel7)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(renameVariableButton, GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE))
                .addContainerGap())
        );
        variablesPanelLayout.setVerticalGroup(variablesPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, variablesPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel7)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, GroupLayout.DEFAULT_SIZE, 157, Short.MAX_VALUE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(renameVariableButton)
                .addContainerGap())
        );

        valueTestPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        jLabel8.setText("Test value:");

        valueTestField.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                valueTestFieldActionPerformed(evt);
            }
        });
        valueTestField.addKeyListener(new KeyAdapter() {
            public void keyReleased(KeyEvent evt) {
                valueTestFieldKeyReleased(evt);
            }
        });

        jButton1.setText("Test!");
        jButton1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        GroupLayout valueTestPanelLayout = new GroupLayout(valueTestPanel);
        valueTestPanel.setLayout(valueTestPanelLayout);
        valueTestPanelLayout.setHorizontalGroup(valueTestPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(valueTestPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel8)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(valueTestField, GroupLayout.DEFAULT_SIZE, 171, Short.MAX_VALUE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButton1)
                .addContainerGap())
        );
        valueTestPanelLayout.setVerticalGroup(valueTestPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(valueTestPanelLayout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(valueTestPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(valueTestField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton1))
                .addGap(5, 5, 5))
        );

        GroupLayout flowCanvasLayout = new GroupLayout(flowCanvas);
        flowCanvas.setLayout(flowCanvasLayout);
        flowCanvasLayout.setHorizontalGroup(flowCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(jPanel9, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel7, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(GroupLayout.Alignment.TRAILING, flowCanvasLayout.createSequentialGroup()
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(flowCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(variablesPanel, GroupLayout.Alignment.TRAILING, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(valueTestPanel, GroupLayout.Alignment.TRAILING, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        flowCanvasLayout.setVerticalGroup(flowCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(flowCanvasLayout.createSequentialGroup()
                .addComponent(jPanel9, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(variablesPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 85, Short.MAX_VALUE)
                .addComponent(valueTestPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel7, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        );

        objectEditorTabs.addTab("Logic", flowCanvas);

        animationChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationChooserActionPerformed(evt);
            }
        });

        newAnimationButton.setText("New");
        newAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newAnimationButtonActionPerformed(evt);
            }
        });

        deleteAnimationButton.setForeground(new Color(255, 0, 0));
        deleteAnimationButton.setText("Delete");
        deleteAnimationButton.setEnabled(false);
        deleteAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteAnimationButtonActionPerformed(evt);
            }
        });

        renameAnimationButton.setText("Rename...");
        renameAnimationButton.setEnabled(false);
        renameAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameAnimationButtonActionPerformed(evt);
            }
        });

        animationSpeedButton.setText("Speed...");
        animationSpeedButton.setEnabled(false);
        animationSpeedButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationSpeedButtonActionPerformed(evt);
            }
        });

        animationSpriteButton.setText("Spritesheet...");
        animationSpriteButton.setEnabled(false);
        animationSpriteButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationSpriteButtonActionPerformed(evt);
            }
        });

        lockAnimationButton.setIcon(new ImageIcon(getClass().getResource("/assets/lock.png"))); // NOI18N
        lockAnimationButton.setActionCommand("a");
        lockAnimationButton.setEnabled(false);
        lockAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        GroupLayout jPanel8Layout = new GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(newAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationChooser, GroupLayout.PREFERRED_SIZE, 150, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lockAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(renameAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationSpriteButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationSpeedButton)
                .addContainerGap(83, Short.MAX_VALUE))
        );
        jPanel8Layout.setVerticalGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(animationChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(newAnimationButton)
                    .addComponent(deleteAnimationButton)
                    .addComponent(renameAnimationButton)
                    .addComponent(animationSpeedButton)
                    .addComponent(animationSpriteButton)
                    .addComponent(lockAnimationButton, GroupLayout.PREFERRED_SIZE, 23, GroupLayout.PREFERRED_SIZE))
                .addGap(5, 5, 5))
        );

        addFrameButton.setText("+");
        addFrameButton.setActionCommand("1");
        addFrameButton.setEnabled(false);
        addFrameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                addFrameButtonActionPerformed(evt);
            }
        });

        removeFrameButton.setText("-");
        removeFrameButton.setActionCommand("-1");
        removeFrameButton.setEnabled(false);
        removeFrameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                addFrameButtonActionPerformed(evt);
            }
        });

        playAnimationButton.setSelected(true);
        playAnimationButton.setText("â–º");
        playAnimationButton.setEnabled(false);
        playAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                playAnimationButtonActionPerformed(evt);
            }
        });

        frameCountLabel.setText("Frame count: 1");

        GroupLayout jPanel6Layout = new GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(addFrameButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(removeFrameButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(frameCountLabel)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(playAnimationButton, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, jPanel6Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(addFrameButton)
                    .addComponent(removeFrameButton)
                    .addComponent(playAnimationButton)
                    .addComponent(frameCountLabel))
                .addGap(5, 5, 5))
        );

        GroupLayout animationCanvasLayout = new GroupLayout(animationCanvas);
        animationCanvas.setLayout(animationCanvasLayout);
        animationCanvasLayout.setHorizontalGroup(animationCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(jPanel8, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel6, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        animationCanvasLayout.setVerticalGroup(animationCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(animationCanvasLayout.createSequentialGroup()
                .addComponent(jPanel8, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 381, Short.MAX_VALUE)
                .addComponent(jPanel6, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        );

        objectEditorTabs.addTab("Animations", animationCanvas);

        GroupLayout objectEditorLayout = new GroupLayout(objectEditor.getContentPane());
        objectEditor.getContentPane().setLayout(objectEditorLayout);
        objectEditorLayout.setHorizontalGroup(objectEditorLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(objectEditorTabs)
            .addComponent(galleryObjectPanel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        objectEditorLayout.setVerticalGroup(objectEditorLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, objectEditorLayout.createSequentialGroup()
                .addComponent(galleryObjectPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(objectEditorTabs))
        );

        setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("PEngine");
        setBackground(new Color(1, 1, 1));
        setBounds(new Rectangle(150, 150, 1000, 600));
        setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
        setMinimumSize(new Dimension(700, 330));
        setModalExclusionType(null);
        setName("windowFrame"); // NOI18N
        addWindowFocusListener(new WindowFocusListener() {
            public void windowGainedFocus(WindowEvent evt) {
                formWindowGainedFocus(evt);
            }
            public void windowLostFocus(WindowEvent evt) {
            }
        });
        addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        sceneCanvas.addMouseMotionListener(new MouseMotionAdapter() {
            public void mouseDragged(MouseEvent evt) {
                sceneCanvasMouseDragged(evt);
            }
            public void mouseMoved(MouseEvent evt) {
                sceneCanvasMouseMoved(evt);
            }
        });
        sceneCanvas.addMouseWheelListener(new MouseWheelListener() {
            public void mouseWheelMoved(MouseWheelEvent evt) {
                sceneCanvasMouseWheelMoved(evt);
            }
        });
        sceneCanvas.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent evt) {
                sceneCanvasMouseClicked(evt);
            }
        });
        sceneCanvas.addPropertyChangeListener(new PropertyChangeListener() {
            public void propertyChange(PropertyChangeEvent evt) {
                sceneCanvasPropertyChange(evt);
                sceneCanvasPropertyChange1(evt);
            }
        });
        sceneCanvas.addKeyListener(new KeyAdapter() {
            public void keyPressed(KeyEvent evt) {
                sceneCanvasKeyPressed(evt);
            }
        });

        jPanel13.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        playButton.setMnemonic('R');
        playButton.setText("â–º");
        playButton.setDoubleBuffered(true);
        playButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                playButtonActionPerformed(evt);
            }
        });

        startAtCurrentLevelCheckBox.setText("Start at current level");
        startAtCurrentLevelCheckBox.setDoubleBuffered(true);

        GroupLayout jPanel13Layout = new GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(startAtCurrentLevelCheckBox)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(playButton, GroupLayout.PREFERRED_SIZE, 53, GroupLayout.PREFERRED_SIZE))
        );
        jPanel13Layout.setVerticalGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                .addComponent(playButton, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE)
                .addComponent(startAtCurrentLevelCheckBox, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE))
        );

        topPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        bringForwardButton.setIcon(new ImageIcon(getClass().getResource("/assets/arrow.png"))); // NOI18N
        bringForwardButton.setToolTipText("Send forward");
        bringForwardButton.setActionCommand("f");
        bringForwardButton.setEnabled(false);
        bringForwardButton.setMaximumSize(new Dimension(85, 23));
        bringForwardButton.setMinimumSize(new Dimension(85, 23));
        bringForwardButton.setPreferredSize(new Dimension(85, 23));
        bringForwardButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                moveZAction(evt);
            }
        });

        sendBackwardsButton.setIcon(new ImageIcon(getClass().getResource("/assets/arrow_down.png"))); // NOI18N
        sendBackwardsButton.setToolTipText("Send backwards");
        sendBackwardsButton.setActionCommand("b");
        sendBackwardsButton.setEnabled(false);
        sendBackwardsButton.setMaximumSize(new Dimension(85, 23));
        sendBackwardsButton.setPreferredSize(new Dimension(85, 23));
        sendBackwardsButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                moveZAction(evt);
            }
        });

        cloneObjectButton.setText("Clone");
        cloneObjectButton.setActionCommand("c");
        cloneObjectButton.setEnabled(false);
        cloneObjectButton.setPreferredSize(new Dimension(85, 23));
        cloneObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnObjectAction(evt);
            }
        });

        editObjectButton.setText("Edit");
        editObjectButton.setEnabled(false);
        editObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                editObjectButtonActionPerformed(evt);
            }
        });

        objectLayerChooser.setModel(new DefaultComboBoxModel(new String[] {"Distance", "Background", "Normal", "Foreground"}));
        objectLayerChooser.setToolTipText("Choose the layer the object lies in");
        objectLayerChooser.setEnabled(false);
        objectLayerChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectLayerChooserActionPerformed(evt);
            }
        });
        objectLayerChooser.setSelectedIndex(-1);

        newObjectButton.setMnemonic('N');
        newObjectButton.setText("New...");
        newObjectButton.setActionCommand("n");
        newObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnObjectAction(evt);
            }
        });

        jLabel1.setText("Layer:");

        deleteObjectButton.setForeground(new Color(255, 0, 0));
        deleteObjectButton.setText("Delete");
        deleteObjectButton.setEnabled(false);
        deleteObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteObjectButtonActionPerformed(evt);
            }
        });

        GroupLayout topPanelLayout = new GroupLayout(topPanel);
        topPanel.setLayout(topPanelLayout);
        topPanelLayout.setHorizontalGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(topPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(newObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(editObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cloneObjectButton, GroupLayout.PREFERRED_SIZE, 61, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteObjectButton)
                .addGap(18, 18, 18)
                .addComponent(jLabel1)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(objectLayerChooser, GroupLayout.PREFERRED_SIZE, 250, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(bringForwardButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sendBackwardsButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        topPanelLayout.setVerticalGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(topPanelLayout.createSequentialGroup()
                .addGap(3, 3, 3)
                .addGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(cloneObjectButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(newObjectButton)
                    .addComponent(editObjectButton)
                    .addComponent(bringForwardButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(sendBackwardsButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(objectLayerChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1)
                    .addComponent(deleteObjectButton))
                .addGap(3, 3, 3))
        );

        jPanel5.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        jCheckBox1.setText("Show grid");
        jCheckBox1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });

        jLabel2.setFont(new Font("Tahoma", 1, 11)); // NOI18N
        jLabel2.setText("Canvas settings");

        GroupLayout jPanel5Layout = new GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(jCheckBox1, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jCheckBox1)
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        GroupLayout sceneCanvasLayout = new GroupLayout(sceneCanvas);
        sceneCanvas.setLayout(sceneCanvasLayout);
        sceneCanvasLayout.setHorizontalGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(topPanel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(GroupLayout.Alignment.TRAILING, sceneCanvasLayout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel5, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel13, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        sceneCanvasLayout.setVerticalGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneCanvasLayout.createSequentialGroup()
                .addComponent(topPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel5, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel13, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        fileMenu.setText("File");

        newProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_N, InputEvent.CTRL_MASK));
        newProjectButton.setText("New project...");
        newProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(newProjectButton);

        openProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.CTRL_MASK));
        openProjectButton.setText("Open existing project...");
        openProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                openProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(openProjectButton);

        saveProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.CTRL_MASK));
        saveProjectButton.setText("Save project...");
        saveProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                saveProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(saveProjectButton);

        menuBar.add(fileMenu);

        projectMenu.setText("Project");
        projectMenu.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                projectMenuActionPerformed(evt);
            }
        });

        newLevelButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_L, InputEvent.CTRL_MASK));
        newLevelButton.setText("New level");
        newLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newLevelButtonActionPerformed(evt);
            }
        });
        projectMenu.add(newLevelButton);

        levelManagerButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_L, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));
        levelManagerButton.setText("Open level manager...");
        levelManagerButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                levelManagerButtonActionPerformed(evt);
            }
        });
        projectMenu.add(levelManagerButton);
        projectMenu.add(jSeparator5);

        objectGalleryButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));
        objectGalleryButton.setText("Open object gallery...");
        objectGalleryButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectGalleryButtonActionPerformed(evt);
            }
        });
        projectMenu.add(objectGalleryButton);
        projectMenu.add(jSeparator6);

        reloadAssetsButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F5, 0));
        reloadAssetsButton.setText("Reload project assets");
        reloadAssetsButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                reloadAssetsButtonActionPerformed(evt);
            }
        });
        projectMenu.add(reloadAssetsButton);

        openAssetsFolderButton.setText("Open assets folder");
        openAssetsFolderButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                openAssetsFolderButtonActionPerformed(evt);
            }
        });
        projectMenu.add(openAssetsFolderButton);
        projectMenu.add(jSeparator4);

        viewRootButton.setText("View root directory...");
        viewRootButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                viewRootButtonActionPerformed(evt);
            }
        });
        projectMenu.add(viewRootButton);

        menuBar.add(projectMenu);

        levelMenu.setText("Level");

        spawnMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        spawnMenuItem.setText("Spawn point...");
        spawnMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(spawnMenuItem);

        cameraLocationMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        cameraLocationMenuItem.setText("Camera location...");
        cameraLocationMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                cameraLocationMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(cameraLocationMenuItem);

        jMenuItem1.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_Z, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        jMenuItem1.setText("Camera zoom...");
        jMenuItem1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        levelMenu.add(jMenuItem1);

        levelBoundsMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_B, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        levelBoundsMenuItem.setText("Bounds...");
        levelBoundsMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                levelBoundsMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(levelBoundsMenuItem);

        jMenu2.setText("Lighting");

        jMenuItem2.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem2.setText("Background");
        jMenuItem2.setEnabled(false);
        jMenu2.add(jMenuItem2);

        topColorMenuItem.setText("Color (top)...");
        topColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                topColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(topColorMenuItem);

        bottomColorMenuItem.setText("Color (bottom)...");
        bottomColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                bottomColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(bottomColorMenuItem);

        jMenuItem10.setText("Swap colors");
        jMenuItem10.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem10ActionPerformed(evt);
            }
        });
        jMenu2.add(jMenuItem10);

        jMenuItem7.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem7.setText("Ambience");
        jMenuItem7.setEnabled(false);
        jMenu2.add(jMenuItem7);

        lightingColorMenuItem.setText("Color...");
        lightingColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lightingColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(lightingColorMenuItem);

        jMenuItem3.setText("Intensity...");
        jMenuItem3.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem3ActionPerformed(evt);
            }
        });
        jMenu2.add(jMenuItem3);

        levelMenu.add(jMenu2);

        jMenu1.setText("Audio");

        jMenuItem8.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem8.setText("Music");
        jMenuItem8.setEnabled(false);
        jMenu1.add(jMenuItem8);

        selectBGMusic.setText("Select track...");
        selectBGMusic.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                selectBGMusicActionPerformed(evt);
            }
        });
        jMenu1.add(selectBGMusic);

        loopBGMusicMenuItem.setSelected(true);
        loopBGMusicMenuItem.setText("Loop");
        loopBGMusicMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                loopBGMusicMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(loopBGMusicMenuItem);

        autoplayBGMusicMenuItem.setSelected(true);
        autoplayBGMusicMenuItem.setText("Autoplay");
        autoplayBGMusicMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                autoplayBGMusicMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(autoplayBGMusicMenuItem);

        musicVolumeMenuItem.setText("Volume...");
        musicVolumeMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                musicVolumeMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(musicVolumeMenuItem);

        jMenuItem9.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem9.setText("Ambient sounds");
        jMenuItem9.setEnabled(false);
        jMenu1.add(jMenuItem9);

        selectAmbienceMenuItem.setText("Select track...");
        selectAmbienceMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                selectAmbienceMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(selectAmbienceMenuItem);

        loopAmbientSoundMenuItem.setSelected(true);
        loopAmbientSoundMenuItem.setText("Loop");
        loopAmbientSoundMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                loopAmbientSoundMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(loopAmbientSoundMenuItem);

        autoplayAmbientSoundMenuItem.setSelected(true);
        autoplayAmbientSoundMenuItem.setText("Autoplay");
        autoplayAmbientSoundMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                autoplayAmbientSoundMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(autoplayAmbientSoundMenuItem);

        ambientSoundVolumeMenuItem.setText("Volume...");
        ambientSoundVolumeMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                ambientSoundVolumeMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(ambientSoundVolumeMenuItem);

        levelMenu.add(jMenu1);

        menuBar.add(levelMenu);

        jMenu3.setText("Help");

        jMenuItem5.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F1, 0));
        jMenuItem5.setText("Help topics...");
        jMenuItem5.setEnabled(false);
        jMenu3.add(jMenuItem5);

        jMenuItem6.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F2, 0));
        jMenuItem6.setText("Check for updates");
        jMenuItem6.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem6ActionPerformed(evt);
            }
        });
        jMenu3.add(jMenuItem6);

        jMenuItem4.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F3, 0));
        jMenuItem4.setText("Visit website...");
        jMenuItem4.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem4ActionPerformed(evt);
            }
        });
        jMenu3.add(jMenuItem4);

        menuBar.add(jMenu3);

        statusIndicator.setEnabled(false);
        statusIndicator.setFont(new Font("Segoe UI", 2, 12)); // NOI18N
        menuBar.add(statusIndicator);

        setJMenuBar(menuBar);

        GroupLayout layout = new GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(sceneCanvas, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(sceneCanvas, GroupLayout.Alignment.TRAILING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void sceneCanvasMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseReleased

    }//GEN-LAST:event_sceneCanvasMouseReleased

    private void formWindowGainedFocus(WindowEvent evt) {//GEN-FIRST:event_formWindowGainedFocus

    }//GEN-LAST:event_formWindowGainedFocus


    private void formWindowClosing(WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        if (promptSave() == 0) {
            System.exit(0);
        }
    }//GEN-LAST:event_formWindowClosing

    private void saveProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_saveProjectButtonActionPerformed
        while (true) {
            String input = JOptionPane.showInputDialog(this, "Project name:", Project.getProject().getName());
            if (input == null) return;
            if (!Project.isValidName(input)) { 
                JOptionPane.showMessageDialog(levelManagerDialog, "\""+input+"\" is not a valid level name!"); continue; 
            }
            if (Project.projectExists(input)) {
                int overwrite = JOptionPane.showConfirmDialog(this, "A project by that name already exists! Overwrite?",
                        "Careful!",
                        JOptionPane.YES_NO_CANCEL_OPTION);
                if (overwrite == JOptionPane.YES_OPTION) {
                    Project.getProject().setName(input);
                    Project.getProject().save();
                    break;
                }
            } else {
                Project.getProject().setName(input);
                Project.getProject().save();
                break;
            }
        }
        GUI.updateWindowTitle();
        sceneCanvas.repaint();
        GUI.refreshObjectProperties();
        objectEditor.setVisible(false);
    }//GEN-LAST:event_saveProjectButtonActionPerformed

    private void newProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newProjectButtonActionPerformed
        if (promptSave() == 0) {
            while (true) {
                String input = JOptionPane.showInputDialog(this, "Project name:", "New project...", JOptionPane.PLAIN_MESSAGE);
                if (input == null) return;
                if (!Project.isValidName(input)) { 
                    JOptionPane.showMessageDialog(levelManagerDialog, "\""+input+"\" is not a valid level name!"); continue; 
                }
                if (Project.projectExists(input)) {
                    JOptionPane.showMessageDialog(this, "Project \"" + input + "\" already exists!");
                } else {
                    Project.newProject(input, true, true);
                    break;
                }
            }
            GUI.updateWindowTitle();
            sceneCanvas.resetCamera();
            sceneCanvas.setSelectedObject(null);
            sceneCanvas.repaint();
            GUI.refreshObjectProperties();
            objectEditor.setVisible(false);
        }
    }//GEN-LAST:event_newProjectButtonActionPerformed

    private void newLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newLevelButtonActionPerformed
        Level l = new Level();
        l.autoName();
        Project.getProject().addLevel(l);
        Project.getProject().switchToLevel(l.getName());
        sceneCanvas.resetCamera();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        GUI.updateWindowTitle();
        GUI.refreshObjectProperties();
        GUI.refreshLevelMenu();
    }//GEN-LAST:event_newLevelButtonActionPerformed

    private void deleteLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteLevelButtonActionPerformed
        Level l = Project.getProject().getLevel(levelChooser.getSelectedIndex());
        if (l == null) return;
        if (l.equals(Project.getProject().getCurrentLevel())) {
            //JOptionPane.showMessageDialog(levelManagerDialog, "This level is being edited and cannot be deleted.");
            JOptionPane.showMessageDialog(levelManagerDialog, "This level is being edited and cannot be deleted.");
            return;
        }
        Project.getProject().deleteLevel(l);
        GUI.refreshChooser(levelChooser, Project.getProject().getLevels());
    }//GEN-LAST:event_deleteLevelButtonActionPerformed

    private void editLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_editLevelButtonActionPerformed
        Level l = Project.getProject().getLevel(levelChooser.getSelectedIndex());
        if (l == null) return;
        if (l.equals(Project.getProject().getCurrentLevel())) {
            //GUI.showMessage("You are already editing this level!", levelManagerDialog);
            JOptionPane.showMessageDialog(levelManagerDialog, "You are already editing this level!");
            return;
        }
        Project.getProject().switchToLevel(l);
        GUI.updateWindowTitle();
        GUI.refreshObjectProperties();
        GUI.refreshLevelMenu();
        sceneCanvas.resetCamera();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        hideDialog(levelManagerDialog);
        GUI.updateWindowTitle();
    }//GEN-LAST:event_editLevelButtonActionPerformed

    private void levelManagerButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_levelManagerButtonActionPerformed
        GUI.refreshChooser(levelChooser, Project.getProject().getLevels());
        showDialog(levelManagerDialog);
    }//GEN-LAST:event_levelManagerButtonActionPerformed

    private void renameLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameLevelButtonActionPerformed
        Level l = Project.getProject().getLevel(levelChooser.getSelectedIndex());
        if (l == null) return;
        String input = JOptionPane.showInputDialog(levelManagerDialog, "Name:", l.getName());
        if (!Level.isValidName(input)) { 
            JOptionPane.showMessageDialog(levelManagerDialog, "\""+input+"\" is not a valid level name!"); return; 
        }
        if (Project.getProject().containsLevel(input)) {
            JOptionPane.showMessageDialog(objectEditor, "A level already exists by that name!");
            return;
        }
        l.setName(input);
        GUI.refreshChooser(levelChooser, Project.getProject().getLevels());

    }//GEN-LAST:event_renameLevelButtonActionPerformed

    private void viewRootButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_viewRootButtonActionPerformed
        File folder = new File(Project.getProject().getDirectory());
        try {
            if (folder.exists()) {
                Desktop.getDesktop().open(folder);
            } else {
                JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
            }
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_viewRootButtonActionPerformed

    private void reloadAssetsButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_reloadAssetsButtonActionPerformed
        if (Project.getProject().existsOnDisk()) {
            Assets.load();
            JOptionPane.showMessageDialog(null, "Successfully loaded "+Assets.assetCount()+" project assets!");
        } else {
            JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
        }

    }//GEN-LAST:event_reloadAssetsButtonActionPerformed

    private void openAssetsFolderButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_openAssetsFolderButtonActionPerformed
        File folder = new File(System.getProperty("user.home") + "/.pengine/projects/" + Project.getProject().getName() + "/assets/");
        try {
            if (folder.exists()) {
                Desktop.getDesktop().open(folder);
            } else {
                JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
            }
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_openAssetsFolderButtonActionPerformed

    private void genericDialogWindowClosing(WindowEvent evt) {//GEN-FIRST:event_genericDialogWindowClosing
        if (!(evt.getComponent() instanceof JDialog)) {
            return;
        }
        hideDialog((JDialog) evt.getComponent());
    }//GEN-LAST:event_genericDialogWindowClosing

    private void levelManagerDialogWindowOpened(WindowEvent evt) {//GEN-FIRST:event_levelManagerDialogWindowOpened

    }//GEN-LAST:event_levelManagerDialogWindowOpened

    private void projectMenuActionPerformed(ActionEvent evt) {//GEN-FIRST:event_projectMenuActionPerformed

    }//GEN-LAST:event_projectMenuActionPerformed

    private void objectCollidesCheckboxActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectCollidesCheckboxActionPerformed
        sceneCanvas.getActiveObject().setCollides(!sceneCanvas.getActiveObject().collides());
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_objectCollidesCheckboxActionPerformed

    private void objectGravityCheckboxActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectGravityCheckboxActionPerformed
        sceneCanvas.getActiveObject().setGravity(!sceneCanvas.getActiveObject().gravity());
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_objectGravityCheckboxActionPerformed

    private void objectGalleryButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectGalleryButtonActionPerformed
        sceneCanvas.setActiveObject(Project.getProject().getGalleryObject(0));
        showObjectEditor();
    }//GEN-LAST:event_objectGalleryButtonActionPerformed

    private void openProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_openProjectButtonActionPerformed
        if (promptSave() == 0) {
            ArrayList<String> spawnList = new ArrayList<String>();
            for (File f : new File(Assets.USER_HOME + "/.pengine/projects").listFiles()) {
                if (!f.isDirectory()) continue;
                if (new File(f.getAbsolutePath() + "/project.txt").exists()) {
                    spawnList.add(f.getName());
                }
            }
            if (spawnList.isEmpty()) {
                JOptionPane.showMessageDialog(this, "There are no existing projects to open!");
                return;
            }
            Object selection = JOptionPane.showInputDialog(this, "Choose a project:", "Open project...",
                    JOptionPane.PLAIN_MESSAGE, null, spawnList.toArray(), null);
            if (selection == null) { return; }
            if (selection.equals(Project.getProject().getName()));
            Project.newProject((String) selection, false, false);
            Project.getProject().load();
            Assets.load();
        }
        GUI.updateWindowTitle();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        GUI.refreshObjectProperties();
        hideObjectEditor();
    }//GEN-LAST:event_openProjectButtonActionPerformed

    private void sceneCanvasKeyPressed(KeyEvent evt) {//GEN-FIRST:event_sceneCanvasKeyPressed
        sceneCanvas.handleKeyPress(evt);
    }//GEN-LAST:event_sceneCanvasKeyPressed

    private void sceneCanvasMouseClicked(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseClicked
        sceneCanvas.handleMouseClick(evt);
    }//GEN-LAST:event_sceneCanvasMouseClicked

    private void sceneCanvasMouseWheelMoved(MouseWheelEvent evt) {//GEN-FIRST:event_sceneCanvasMouseWheelMoved
        sceneCanvas.handleMouseWheel(evt);
    }//GEN-LAST:event_sceneCanvasMouseWheelMoved

    private void sceneCanvasMouseMoved(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseMoved
        sceneCanvas.handleMouseMovement(evt);
    }//GEN-LAST:event_sceneCanvasMouseMoved

    private void sceneCanvasMouseDragged(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseDragged
        sceneCanvas.handleMouseDrag(evt);
    }//GEN-LAST:event_sceneCanvasMouseDragged

    private void objectLayerChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectLayerChooserActionPerformed
        if (sceneCanvas.getSelectedObject() == null) return;
        Project.getProject().getCurrentLevel().moveToLayer(1 + objectLayerChooser.getSelectedIndex(), sceneCanvas.getSelectedObject());
        sceneCanvas.repaint();
    }//GEN-LAST:event_objectLayerChooserActionPerformed

    private void editObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_editObjectButtonActionPerformed
        sceneCanvas.setActiveObject(sceneCanvas.getSelectedObject());
        GUI.refreshObjectEditor();
        showObjectEditor();
    }//GEN-LAST:event_editObjectButtonActionPerformed

    private void spawnObjectAction(ActionEvent evt) {//GEN-FIRST:event_spawnObjectAction
        String cmd = evt.getActionCommand();
        char c = cmd.charAt(0);
        SceneObject o = new SceneObject(), src = null;
        if (c == 'c') {
            src = sceneCanvas.getSelectedObject();
        } else if (c == 'n') {
            ArrayList<String> spawnList = new ArrayList<String>();
            spawnList.add("Empty hitbox");
            for (SceneObject s : Project.getProject().getGalleryObjects()) {
                spawnList.add(s.toString());
            }
            spawnList.remove(1); //remove PLAYER gallery object
            Object selection = JOptionPane.showInputDialog(this, "Choose a gallery object to spawn:", "Spawn new object...",
                    JOptionPane.PLAIN_MESSAGE, null, spawnList.toArray(), null);
            if (selection == null) {
                return;
            }
            if ("Empty hitbox".equals(selection)) {
                o.setHitbox(true);
                o.autoName("hitbox", Project.getProject().getCurrentLevel());
            } else {
                src = Project.getProject().getGalleryObject((String) selection);
            }
        }

        if (src != null) {
            src.copyTo(o, false, false);
            o.autoName(src.toString(), Project.getProject().getCurrentLevel());
        }

        o.setWorldX((int) sceneCanvas.getCameraX());
        o.setWorldY((int) sceneCanvas.getCameraY());
        Project.getProject().getCurrentLevel().add(o);

        sceneCanvas.setSelectedObject(o);
        sceneCanvas.repaint();
        GUI.refreshObjectProperties();
        System.out.println("Added new object: " + o.getName());
    }//GEN-LAST:event_spawnObjectAction

    private void moveZAction(ActionEvent evt) {//GEN-FIRST:event_moveZAction
        char c = evt.getActionCommand().charAt(0);
        if (sceneCanvas.getSelectedObject() != null) {
            if (c == 'f') {
                Project.getProject().getCurrentLevel().moveForward(sceneCanvas.getSelectedObject());
            }
            if (c == 'b') {
                Project.getProject().getCurrentLevel().moveBackward(sceneCanvas.getSelectedObject());
            }
            sceneCanvas.repaint();
        }
    }//GEN-LAST:event_moveZAction

    private void topColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_topColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the top background color...", Project.getProject().getCurrentLevel().getTopBGColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setTopBGColor(c);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_topColorMenuItemActionPerformed

    private void bottomColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_bottomColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the bottom background color...", Project.getProject().getCurrentLevel().getBottomBGColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setBottomBGColor(c);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_bottomColorMenuItemActionPerformed

    private void lightingColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_lightingColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the lighting color...", Project.getProject().getCurrentLevel().getLightingColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setLightingColor(c);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_lightingColorMenuItemActionPerformed

    private void jMenuItem3ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem3ActionPerformed
        String input = JOptionPane.showInputDialog(this, "Ambient light intensity (%):", 
                (int)(Project.getProject().getCurrentLevel().getLightIntensity()*100));
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length > 0) {
            double percent = (double) parsed[0] / 100d;
            Project.getProject().getCurrentLevel().setLightingIntensity(percent);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_jMenuItem3ActionPerformed

    private void spawnMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_spawnMenuItemActionPerformed
        int[] spawn = Project.getProject().getCurrentLevel().playerSpawn();
        String input = JOptionPane.showInputDialog(this, "Coordinates:", spawn[0]+" "+spawn[1]);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 2) {
            Project.getProject().getCurrentLevel().setPlayerSpawn(parsed[0], parsed[1]);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_spawnMenuItemActionPerformed

    private void cameraLocationMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_cameraLocationMenuItemActionPerformed
        int[] spawn = Project.getProject().getCurrentLevel().cameraSpawn();
        String input = JOptionPane.showInputDialog(this, "Camera location:", spawn[0]+" "+spawn[1]);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 2) {
            Project.getProject().getCurrentLevel().setCameraSpawn(parsed[0], parsed[1]);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_cameraLocationMenuItemActionPerformed

    private void selectBGMusicActionPerformed(ActionEvent evt) {//GEN-FIRST:event_selectBGMusicActionPerformed
        String input = JOptionPane.showInputDialog(this, "Set background music...",
                Project.getProject().getCurrentLevel().getBGMusic());
        if (input != null) {
            Project.getProject().getCurrentLevel().setBGMusic(input);
        }
    }//GEN-LAST:event_selectBGMusicActionPerformed

    private void selectAmbienceMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_selectAmbienceMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Set ambient sound...",
                Project.getProject().getCurrentLevel().getAmbientSound());
        if (input != null) {
            Project.getProject().getCurrentLevel().setAmbientSound(input);
        }
    }//GEN-LAST:event_selectAmbienceMenuItemActionPerformed

    private void loopBGMusicMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_loopBGMusicMenuItemActionPerformed
        Project.getProject().getCurrentLevel().loopBGMusic(loopBGMusicMenuItem.isSelected());
    }//GEN-LAST:event_loopBGMusicMenuItemActionPerformed

    private void autoplayBGMusicMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_autoplayBGMusicMenuItemActionPerformed
        Project.getProject().getCurrentLevel().autoPlayBGMusic(autoplayBGMusicMenuItem.isSelected());
    }//GEN-LAST:event_autoplayBGMusicMenuItemActionPerformed

    private void loopAmbientSoundMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_loopAmbientSoundMenuItemActionPerformed
        Project.getProject().getCurrentLevel().loopBGAmbience(loopAmbientSoundMenuItem.isSelected());
    }//GEN-LAST:event_loopAmbientSoundMenuItemActionPerformed

    private void autoplayAmbientSoundMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_autoplayAmbientSoundMenuItemActionPerformed
        Project.getProject().getCurrentLevel().autoPlayBGAmbience(autoplayAmbientSoundMenuItem.isSelected());
    }//GEN-LAST:event_autoplayAmbientSoundMenuItemActionPerformed

    private void playButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_playButtonActionPerformed
        if (!Project.getProject().existsOnDisk()) {
            JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
        } else {
            promptSave();
            runProject(startAtCurrentLevelCheckBox.isSelected()
                ? Project.getProject().getCurrentLevel().getName() : Project.getProject().getHomeLevel().getName());
        }
        
    }//GEN-LAST:event_playButtonActionPerformed

    private void levelBoundsMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_levelBoundsMenuItemActionPerformed
        int[] bounds = Project.getProject().getCurrentLevel().bounds();
        String input = JOptionPane.showInputDialog(this, "Bounds:", 
                bounds[0]+" "+bounds[1]+" "+bounds[2]+" "+bounds[3]);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 4) {
            Project.getProject().getCurrentLevel()
                    .setBounds(parsed[0], parsed[1], parsed[2], parsed[3]);
        }
        sceneCanvas.repaint();
    }//GEN-LAST:event_levelBoundsMenuItemActionPerformed

    private void jCheckBox1ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jCheckBox1ActionPerformed
        sceneCanvas.setShowGrid(jCheckBox1.isSelected());
        sceneCanvas.repaint();
    }//GEN-LAST:event_jCheckBox1ActionPerformed

    private void deleteObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteObjectButtonActionPerformed
        Project.getProject().getCurrentLevel().removeObject(sceneCanvas.getSelectedObject());
        sceneCanvas.repaint();
        sceneCanvas.setSelectedObject(null);
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_deleteObjectButtonActionPerformed

    private void changeObjectProperty(ActionEvent evt) {//GEN-FIRST:event_changeObjectProperty
        char cmd = evt.getActionCommand().charAt(0);
        SceneObject o = sceneCanvas.getActiveObject();
        
        while (true) {
            String input = JOptionPane.showInputDialog(objectEditor,
                    cmd == 'c' ? "Type:" : (cmd == 'n' ? "Name:" : "Texture:"),
                    cmd == 'c' ? o.getType() : (cmd == 'n' ? o.getName() : o.getTexture()));
            if (input == null) return;
            if (!Project.isValidName(input) && cmd != 't') { 
                JOptionPane.showMessageDialog(levelManagerDialog, 
                        "\""+input+"\" is not a valid "+(cmd == 'c' ? "type" : "name")+"!"); continue; 
            }
            boolean gallery = Project.getProject().containsGalleryObject(input);
            boolean level = Project.getProject().getCurrentLevel().containsObject(input);
            if ((cmd == 'c' && gallery) || (cmd == 'n' && level)) {
                JOptionPane.showMessageDialog(objectEditor, "This "+(cmd == 'c' ? "type " : "")+"name is already taken!");
                continue;
            }
            
            if (cmd == 'c') {
            for (SceneObject o2: Project.getProject().getObjectsByType(sceneCanvas.getActiveObject().getType())) o2.setType(input);
                sceneCanvas.getActiveObject().setType(input);
                GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
            }
            if (cmd == 'n') {
                sceneCanvas.getActiveObject().setName(input);
            }
            if (cmd == 't') {
                sceneCanvas.getActiveObject().setTexture(input);
            }
            
            break;
        }

        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_changeObjectProperty

    private void newAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newAnimationButtonActionPerformed
        sceneCanvas.getActiveObject().newAnimation();
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
        animationChooser.setSelectedIndex(sceneCanvas.getActiveObject().getAnimations().size() - 1);
    }//GEN-LAST:event_newAnimationButtonActionPerformed

    private void deleteAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteAnimationButtonActionPerformed
        sceneCanvas.getActiveObject().getAnimations().remove(animationChooser.getSelectedIndex());
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
    }//GEN-LAST:event_deleteAnimationButtonActionPerformed

    private void jMenuItem1ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
        String input = JOptionPane.showInputDialog(this, "Camera zoom (1x - 8x):", Project.getProject().getCurrentLevel().getZoom());
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setZoom(parsed[0]);
        }
    }//GEN-LAST:event_jMenuItem1ActionPerformed

    private void musicVolumeMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_musicVolumeMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Volume (%):",
                (int) (Project.getProject().getCurrentLevel().getBGMusicVolume() * 100));
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setBGMusicVolume(parsed[0] / 100f);
        }
    }//GEN-LAST:event_musicVolumeMenuItemActionPerformed

    private void ambientSoundVolumeMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_ambientSoundVolumeMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Volume (%):",
                (int) (Project.getProject().getCurrentLevel().getBGMusicVolume() * 100));
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setBGAmbienceVolume(parsed[0] / 100f);
        }
    }//GEN-LAST:event_ambientSoundVolumeMenuItemActionPerformed

    private void objectEditorWindowClosing(WindowEvent evt) {//GEN-FIRST:event_objectEditorWindowClosing
        hideObjectEditor();
        Project.getProject().applyGalleryChanges(sceneCanvas.getActiveObject());
    }//GEN-LAST:event_objectEditorWindowClosing

    private void sceneCanvasPropertyChange(PropertyChangeEvent evt) {//GEN-FIRST:event_sceneCanvasPropertyChange
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }//GEN-LAST:event_sceneCanvasPropertyChange

    private void galleryObjectChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_galleryObjectChooserActionPerformed
        int index = galleryObjectChooser.getSelectedIndex();
        deleteGalleryObjectButton.setEnabled(index > 0);
        if (index < 0) return;
        sceneCanvas.setActiveObject(
                Project.getProject().getGalleryObject(index));
        refreshObjectEditor();
        objectEditorTabs.setSelectedIndex(0);
    }//GEN-LAST:event_galleryObjectChooserActionPerformed

    private void newGalleryObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newGalleryObjectButtonActionPerformed
        SceneObject o = new SceneObject();
        o.autoName("object", null); //autoname gallery object
        Project.getProject().addGalleryObject(o);
        GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        galleryObjectChooser.setSelectedIndex(Project.getProject().getGalleryObjects().size() - 1);
        sceneCanvas.setActiveObject(o);
        refreshObjectEditor();
    }//GEN-LAST:event_newGalleryObjectButtonActionPerformed

    private void deleteGalleryObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteGalleryObjectButtonActionPerformed
        Project.getProject().removeGalleryObject(galleryObjectChooser.getSelectedIndex());
        GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        sceneCanvas.setActiveObject(Project.getProject().getGalleryObject(galleryObjectChooser.getSelectedIndex()));
        refreshObjectEditor();
    }//GEN-LAST:event_deleteGalleryObjectButtonActionPerformed

    private void sceneCanvasPropertyChange1(PropertyChangeEvent evt) {//GEN-FIRST:event_sceneCanvasPropertyChange1
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }//GEN-LAST:event_sceneCanvasPropertyChange1

    private void renameAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameAnimationButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        while (true) {
            String input = JOptionPane.showInputDialog(objectEditor, "Name:", a.getName());
            if (input == null) return;
            if (!Animation.isValidName(input)) { 
                JOptionPane.showMessageDialog(levelManagerDialog, "\""+input+"\" is not a valid flowchart name!"); continue; 
            }
            if (sceneCanvas.getActiveObject().containsAnimation(input)) {
                JOptionPane.showMessageDialog(objectEditor, "An animation already exists by that name!");
                continue;
            }
            a.setName(input); break;
        }
        
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
    }//GEN-LAST:event_renameAnimationButtonActionPerformed

    private void animationSpriteButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationSpriteButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        String input = JOptionPane.showInputDialog(objectEditor, "Spritesheet:", a.getSpriteSheet());
        if (input == null) return;
        a.setSpriteSheet(input);
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationSpriteButtonActionPerformed

    private void animationSpeedButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationSpeedButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        String input = JOptionPane.showInputDialog(objectEditor, "Frame duration (ms):", a.getFrameDuration());
        if (input == null) return;
        a.setFrameDuration(Integer.parseInt(input));
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationSpeedButtonActionPerformed

    private void playAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_playAnimationButtonActionPerformed
        animationCanvas.reset();
        animationCanvas.setPaused(!playAnimationButton.isSelected());
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_playAnimationButtonActionPerformed

    private void animationChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationChooserActionPerformed
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationChooserActionPerformed

    private void addFrameButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_addFrameButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        a.addFrameCount(Integer.parseInt(evt.getActionCommand()));
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_addFrameButtonActionPerformed

    private void lockTextureButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_lockTextureButtonActionPerformed
        char cmd = evt.getActionCommand().charAt(0);
        JToggleButton source = (JToggleButton)evt.getSource();
        if (cmd == 'a') {
            Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
            a.setLocked(source.isSelected());
        } else if (cmd == 'f') {
            Flow f = sceneCanvas.getActiveObject().getFlows().get(flowChooser.getSelectedIndex());
            f.setLocked(source.isSelected());
        }  else {
            sceneCanvas.getActiveObject().setLocked(Integer.parseInt(cmd+""), source.isSelected());
        }
    }//GEN-LAST:event_lockTextureButtonActionPerformed

    private void jMenuItem4ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem4ActionPerformed
        try {
            java.awt.Desktop.getDesktop().browse(new URI("http://computerology.bitbucket.io"));
        } catch (URISyntaxException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jMenuItem4ActionPerformed

    private void jMenuItem6ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem6ActionPerformed
        UpdateManager.checkForUpdates();
        if (UpdateManager.editorUpdate()) {
            JOptionPane.showMessageDialog(window, "A newer version of the level editor has been found!"
                + "\nGo to 'Help â†’ Visit website' to download it.");
        } else {
            JOptionPane.showMessageDialog(window, "Looks like you have the latest version!");
        }
    }//GEN-LAST:event_jMenuItem6ActionPerformed

    private void setHomeButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_setHomeButtonActionPerformed
        Level l = Project.getProject().getLevel(levelChooser.getSelectedIndex());
        if (l == null) return;
        Project.getProject().setHomeLevel(l);
        GUI.refreshChooser(levelChooser, Project.getProject().getLevels());
    }//GEN-LAST:event_setHomeButtonActionPerformed

    private void levelChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_levelChooserActionPerformed
        Level l = Project.getProject().getLevel(levelChooser.getSelectedIndex());
        if (l == null) return;
        setHomeButton.setEnabled(!l.equals(Project.getProject().getHomeLevel()));
    }//GEN-LAST:event_levelChooserActionPerformed

    private void flowCanvasMouseMoved(MouseEvent evt) {//GEN-FIRST:event_flowCanvasMouseMoved
        flowCanvas.handleMouseMovement(evt);
    }//GEN-LAST:event_flowCanvasMouseMoved

    private void flowCanvasMouseDragged(MouseEvent evt) {//GEN-FIRST:event_flowCanvasMouseDragged
        flowCanvas.handleMouseDrag(evt);
    }//GEN-LAST:event_flowCanvasMouseDragged

    private void flowCanvasMouseClicked(MouseEvent evt) {//GEN-FIRST:event_flowCanvasMouseClicked
        flowCanvas.handleMouseClick(evt);
    }//GEN-LAST:event_flowCanvasMouseClicked

    private void flowChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_flowChooserActionPerformed
        GUI.refreshFlowOptions();
        flowCanvas.resetCamera();
    }//GEN-LAST:event_flowChooserActionPerformed

    private void newFlowButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newFlowButtonActionPerformed
        sceneCanvas.getActiveObject().newFlow();
        GUI.refreshChooser(flowChooser, sceneCanvas.getActiveObject().getFlows());
        flowChooser.setSelectedIndex(sceneCanvas.getActiveObject().getFlows().size() - 1);
    }//GEN-LAST:event_newFlowButtonActionPerformed

    private void deleteFlowButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteFlowButtonActionPerformed
        sceneCanvas.getActiveObject().getFlows().remove(flowChooser.getSelectedIndex());
        GUI.refreshChooser(flowChooser, sceneCanvas.getActiveObject().getFlows());
    }//GEN-LAST:event_deleteFlowButtonActionPerformed

    private void renameFlowButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameFlowButtonActionPerformed
        double[] cam = new double[]{flowCanvas.getCameraX(), flowCanvas.getCameraY()};
        Flow a = sceneCanvas.getActiveObject().getFlows().get(flowChooser.getSelectedIndex());
        while (true) {
            String input = JOptionPane.showInputDialog(objectEditor, "Name:", a.getName());
            if (input == null) return;
            if (!Flow.isValidName(input)) { 
                JOptionPane.showMessageDialog(levelManagerDialog, "\""+input+"\" is not a valid flowchart name!"); continue; 
            }
            if (sceneCanvas.getActiveObject().containsFlow(input)) {
                JOptionPane.showMessageDialog(objectEditor, "A flowchart already exists by that name!");
                continue;
            }
            a.setName(input); break;
        }
        GUI.refreshChooser(flowChooser, sceneCanvas.getActiveObject().getFlows());
        flowCanvas.setCamera((int)cam[0], (int)cam[1]);
    }//GEN-LAST:event_renameFlowButtonActionPerformed

    private void addBlockButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_addBlockButtonActionPerformed
        ArrayList<String> blockList = new ArrayList<String>();
        for (Block b : Assets.getBlocks()) {
            blockList.add(b.toString());
        }
        Object selection = JOptionPane.showInputDialog(objectEditor, "Choose a block:", "Add block...",
                JOptionPane.PLAIN_MESSAGE, null, blockList.toArray(), null);
        if (selection == null) return;
        String s = (String)selection;
        String type = s.substring(s.lastIndexOf("(")+1, s.lastIndexOf(")"));
        Block b = Block.create(type);
        b.setX((int)flowCanvas.getCameraX());
        b.setY((int)flowCanvas.getCameraY());
        flowCanvas.getFlow().addBlock(b);
        flowCanvas.setSelectedBlock(b);
        GUI.refreshFlowOptions();
    }//GEN-LAST:event_addBlockButtonActionPerformed

    private void deleteBlockButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteBlockButtonActionPerformed
        Block b = flowCanvas.getSelectedBlock();
        if (b == null) return;
        flowCanvas.getFlow().removeBlock(flowCanvas.getFlow().indexOf(b));
        flowCanvas.setSelectedBlock(null);
        GUI.refreshFlowOptions();
    }//GEN-LAST:event_deleteBlockButtonActionPerformed

    private void setBlockInputValueActionPerformed(ActionEvent evt) {//GEN-FIRST:event_setBlockInputValueActionPerformed
        char cmd = evt.getActionCommand().charAt(0);
        Block b = flowCanvas.getSelectedBlock();
        if (b == null) return;
        Object[] p = cmd == 'i' ? b.getInput(blockInputChooser.getSelectedIndex())
            : b.getOutput(blockOutputChooser.getSelectedIndex());
        if (p == null) return;
        while (true) {
            String input = JOptionPane.showInputDialog(objectEditor, (String)p[0]+" ("+Types.getTypeName((int)p[1])+"):", (String)p[2]);
            if (input == null) return;
            boolean valid_var = Types.isValidInput(input, Types.VARIABLE);
            boolean var_exists = b.getParent().varExists(input);
            boolean valid_in = Types.isValidInput(input, (int)p[1]);
            boolean accept = false;
            
            if (cmd == 'i') {
                if (valid_var) { 
                    if (!var_exists) { JOptionPane.showMessageDialog(objectEditor, "Variable \""+input+"\" does not exist!"); }
                    if (var_exists) accept = true;
                } else {
                    if (!valid_in) {
                        JOptionPane.showMessageDialog(objectEditor, 
                                "Input is invalid for type \""+Types.getTypeName((int)p[1])+"\".");
                    } else {
                        accept = true;
                        if (Types.isComplex((int)p[1])) {
                            String verify = Types.verifyParams(input, (int)p[1]);
                            if (verify != null) {
                                JOptionPane.showMessageDialog(objectEditor, verify);
                                continue;
                            }
                        }
                    }
                }
            }
            
            if (cmd == 'o') {
                if (valid_var) {
                    accept = true;
                } else {
                    JOptionPane.showMessageDialog(objectEditor, 
                            "\""+input+"\" is not a valid variable name!");
                }
            }
            
            if (accept) { p[2] = input; GUI.refreshFlowOptions(); return; }

        }
    }//GEN-LAST:event_setBlockInputValueActionPerformed

    private void renameVariableButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameVariableButtonActionPerformed
        Flow f = sceneCanvas.getActiveObject().getFlows().get(flowChooser.getSelectedIndex());
        String prev = variablesList.getSelectedValue();
        while (true) {
            String input = JOptionPane.showInputDialog(objectEditor, "Rename variable:", prev);
            if (input == null) return;
            if (!Types.isValidInput(input, Types.VARIABLE)) {
                JOptionPane.showMessageDialog(objectEditor, 
                            "\""+input+"\" is not a valid variable name!");
                continue;
            }
            f.renameVar(prev, input); GUI.refreshFlowOptions(); break;
        }
    }//GEN-LAST:event_renameVariableButtonActionPerformed

    private void jMenuItem10ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem10ActionPerformed
        Level curr = Project.getProject().getCurrentLevel();
        Color top = curr.getTopBGColor();
        Color bottom = curr.getBottomBGColor();
        curr.setTopBGColor(bottom);
        curr.setBottomBGColor(top);
        sceneCanvas.repaint();
    }//GEN-LAST:event_jMenuItem10ActionPerformed

    private void valueTestFieldActionPerformed(ActionEvent evt) {//GEN-FIRST:event_valueTestFieldActionPerformed

    }//GEN-LAST:event_valueTestFieldActionPerformed

    private void valueTestFieldKeyReleased(KeyEvent evt) {//GEN-FIRST:event_valueTestFieldKeyReleased

    }//GEN-LAST:event_valueTestFieldKeyReleased

    private void jButton1ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        Flow f = flowCanvas.getFlow();
        String in = valueTestField.getText();
        String summary = "Input: "+in+"\n";
        int t = Types.getType(in);
        summary += t < 0 ? "Type: <none>\n" : "Type: "+Types.getTypeName(t)+"\n";
        if (Types.isComplex(t)) {
            String verify = Types.verifyParams(in, t);
            summary += verify == null ? "" : "Error: "+verify;
        } else {
            summary += (t == Types.VARIABLE ? "Exists in flow: "+(f.varExists(in) ? "Yes" : "No") : "");
        }
        JOptionPane.showMessageDialog(objectEditor, summary);
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
     * Returns 0 if user made a YES or NO choice. 1 if the user canceled.
     *
     * @return An int.
     */
    public int promptSave() {
        int dialogResult = JOptionPane.showConfirmDialog(this, "Would you like to save your progress?", "Hold on a second...",
                JOptionPane.YES_NO_CANCEL_OPTION);
        if (dialogResult == JOptionPane.CLOSED_OPTION) dialogResult = JOptionPane.CANCEL_OPTION;
        if (dialogResult == JOptionPane.YES_OPTION) Project.getProject().save();
        return dialogResult != JOptionPane.CANCEL_OPTION ? 0 : 1;
    }

    public static SceneCanvas getSceneCanvas() {
        return sceneCanvas;
    }

    public static AnimationCanvas getAnimationCanvas() {
        return animationCanvas;
    }
    
    public static FlowCanvas getFlowCanvas() {
        return flowCanvas;
    }

    public static void showDialog(JDialog d) {
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        double width = screenSize.getWidth();
        double height = screenSize.getHeight();
        d.setLocation(window.getX() + (int) (window.getWidth() / 2) - (d.getWidth() / 2),
                window.getY() + (int) (window.getHeight() / 2) - ((d.getHeight() / 2)));
        d.setModal(true);
        d.setModalityType(Dialog.ModalityType.APPLICATION_MODAL);
        d.setVisible(true);
        System.out.println("Showing " + d.getTitle());
    }

    public void showObjectEditor() {
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        double width = screenSize.getWidth();
        double height = screenSize.getHeight();
        JFrame d = objectEditor;
        d.setSize(d.getPreferredSize());
        d.setLocation((int) (width / 2) - (d.getWidth() / 2),
                (int) (height / 2) - ((d.getHeight() / 2)));
        d.setVisible(true);
        this.setEnabled(false);
        if (Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject())) {
            GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        }
        objectEditorTabs.setSelectedIndex(0);
        System.out.println("Showing " + d.getTitle());
    }
    
    public void hideObjectEditor() {
        JFrame d = objectEditor;
        d.setVisible(false);
        this.setEnabled(true);
        this.setVisible(true);
        this.toFront();
        System.out.println("Hiding " + d.getTitle());
    }

    public static void hideDialog(JDialog d) {
        d.setVisible(false);
        d.setModal(false);
        System.out.println("Hiding " + d.getTitle());
    }

    /**
     * Clear and populate the JList with the contents of the ArrayList. Calls
     * adds toString() of each element to the JList.
     *
     * @param l The JList to refresh.
     * @param arr The list.
     */
    public static void refreshList(JList l, Object[] arr) {
        int index = l.getSelectedIndex();
        String[] list = new String[arr.length];
        for (int i = 0; i < arr.length; i++) {
            list[i] = arr[i].toString();
        }
        l.setListData(list);
        if (index >= arr.length) index = arr.length - 1;
        if (index < 0 && arr.length > 0) index = 0;
        l.setSelectedIndex(index);
    }
    
    public static void refreshChooser(JComboBox l, Object[] arr) {
        int index = l.getSelectedIndex();
        l.removeAllItems();
        for (int i = 0; i < arr.length; i++) l.addItem(arr[i].toString());
        if (index >= arr.length) index = arr.length - 1;
        if (index < 0 && arr.length > 0) index = 0;
        l.setSelectedIndex(index);
    }
    
    public static void refreshList(JList l, ArrayList arr) {
        refreshList(l, arr.toArray());
    }
    
    public static void refreshChooser(JComboBox l, ArrayList arr) {
        refreshChooser(l, arr.toArray());
    }

    public static void updateWindowTitle() {
        if (window == null) return;
        String title = "PEngine "+UpdateManager.VERSION_NAME+" - ";
        title += "/" + Project.getProject().getName();
        if (Project.getProject().getCurrentLevel() != null) {
            title += "/" + Project.getProject().getCurrentLevel().getName();
        }
        window.setTitle(title);
    }

    public static void refreshObjectEditor() {
        
        if (sceneCanvas.getActiveObject() == null) return;

        /**
         * GENERAL EDITOR STUFF
         */
        objectEditor.setTitle("Editing \"" + sceneCanvas.getActiveObject() + "\"");
        galleryObjectPanel.setVisible(Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject()));
        deleteGalleryObjectButton.setEnabled(galleryObjectChooser.getSelectedIndex() > 0);
        
        /**
         * TABS
         */
        refreshBasicObjectOptions();
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
        GUI.refreshChooser(flowChooser, sceneCanvas.getActiveObject().getFlows());
        
        objectEditorTabs.setEnabledAt(2, !sceneCanvas.getActiveObject().isHitbox()); //animation tab
        
    }
    
    public static void refreshBasicObjectOptions() {
        objectTypeField.setText(sceneCanvas.getActiveObject().getType());
        objectTextureField.setText(sceneCanvas.getActiveObject().getTexture());
        objectNameField.setText(sceneCanvas.getActiveObject().getName());
        objectGravityCheckbox.setSelected(sceneCanvas.getActiveObject().gravity());
        objectCollidesCheckbox.setSelected(sceneCanvas.getActiveObject().collides());
        changeObjectTypeButton.setEnabled(Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject())
                && !"Player".equals(sceneCanvas.getActiveObject().getType()));
        changeObjectNameButton.setEnabled(!Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject()));
        changeObjectTextureButton.setEnabled(!sceneCanvas.getActiveObject().isHitbox());
        sceneObjectCanvas.repaint();
        
        boolean gallery = Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject());
        boolean hitbox = sceneCanvas.getActiveObject().isHitbox();
        lockTextureButton.setEnabled(!gallery && !hitbox);
        lockGravityButton.setEnabled(!gallery && !hitbox);
        lockCollidesButton.setEnabled(!gallery && !hitbox);
        lockTextureButton.setSelected(sceneCanvas.getActiveObject().isLocked(0));
        lockGravityButton.setSelected(sceneCanvas.getActiveObject().isLocked(1));
        lockCollidesButton.setSelected(sceneCanvas.getActiveObject().isLocked(2));
        
    }
    
    public static void refreshAnimationOptions() {
        boolean inbound = animationChooser.getSelectedIndex() > -1;
        boolean gallery = Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject());
        boolean hitbox = sceneCanvas.getActiveObject().isHitbox();
        deleteAnimationButton.setEnabled(inbound);
        renameAnimationButton.setEnabled(inbound);
        animationSpriteButton.setEnabled(inbound);
        animationSpeedButton.setEnabled(inbound);
        addFrameButton.setEnabled(inbound);
        playAnimationButton.setEnabled(inbound);
        lockAnimationButton.setEnabled(inbound && !gallery && !hitbox);
        lockAnimationButton.setSelected(false);
        
        if (animationChooser.getSelectedIndex() < 0) {
            animationCanvas.clearAnimation();
            return;
        }
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        lockAnimationButton.setSelected(a.isLocked());
        removeFrameButton.setEnabled(a.frameCount() > 0 && inbound);
        frameCountLabel.setText("Frame count: "+a.frameCount());
        removeFrameButton.setEnabled(a.frameCount() > 1);
        animationCanvas.setAnimation(a);
        animationCanvas.reset();
        animationCanvas.repaint();
    }

    public static void refreshFlowOptions() {
        boolean inbound = flowChooser.getSelectedIndex() > -1;
        boolean gallery = Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject());
        boolean hitbox = sceneCanvas.getActiveObject().isHitbox();
        deleteFlowButton.setEnabled(inbound);
        renameFlowButton.setEnabled(inbound);
        lockFlowButton.setEnabled(inbound && !gallery && !hitbox);
        lockFlowButton.setSelected(false);
        addBlockButton.setEnabled(inbound);
        variablesPanel.setVisible(inbound);
        valueTestPanel.setVisible(inbound);
        if (inbound) {
            Flow a = sceneCanvas.getActiveObject().getFlows().get(flowChooser.getSelectedIndex());
            a.refreshVars();
            GUI.refreshList(variablesList, a.getVars());
            renameVariableButton.setEnabled(variablesList.getSelectedIndex() > -1);
            lockAnimationButton.setSelected(a.isLocked());
            flowCanvas.setFlow(a);
            lockFlowButton.setSelected(a.isLocked());
        } else {
            flowCanvas.setFlow(null);
        }
        Block selected = flowCanvas.getSelectedBlock();
        if (selected != null) {
            ArrayList<String> params = new ArrayList<String>();
            for (int i = 0; i < selected.inputCount(); i++) {
                Object[] p = selected.getInput(i);
                params.add((String)p[0]+" ("+Types.getTypeName((int)p[1])+")");
            }
            GUI.refreshChooser(blockInputChooser, params);
            params.clear();
            for (int i = 0; i < selected.outputCount(); i++) {
                Object[] p = selected.getOutput(i);
                params.add((String)p[0]+" ("+Types.getTypeName((int)p[1])+")");
            }
            GUI.refreshChooser(blockOutputChooser, params);
        } else {
            blockInputChooser.removeAllItems();
        }
        blockInputChooser.setEnabled(selected != null);
        blockOutputChooser.setEnabled(selected != null);
        setBlockInputValue.setEnabled(selected != null && blockInputChooser.getSelectedIndex() > -1);
        setBlockOutputValue.setEnabled(selected != null && blockOutputChooser.getSelectedIndex() > -1);
        deleteBlockButton.setEnabled(inbound && selected != null);
        flowCanvas.repaint();
    }

    public static void refreshLevelMenu() {
        Level current = Project.getProject().getCurrentLevel();
        loopAmbientSoundMenuItem.setSelected(current.loopBGAmbience());
        loopBGMusicMenuItem.setSelected(current.loopBGMusic());
        autoplayAmbientSoundMenuItem.setSelected(current.autoPlayBGAmbience());
        autoplayBGMusicMenuItem.setSelected(current.autoPlayBGMusic());
        sceneCanvas.repaint();
    }

    public static void refreshObjectProperties() {
        objectLayerChooser.setEnabled(sceneCanvas.getSelectedObject() != null);
        objectLayerChooser.setSelectedIndex(sceneCanvas.getSelectedObject() != null
                ? sceneCanvas.getSelectedObject().getLayer() - 1 : -1);
        bringForwardButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        sendBackwardsButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        cloneObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        deleteObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }

    public void runProject(String level_name) {
        UpdateManager.checkForUpdates();
        
        if (UpdateManager.runtimeUpdate()) {
            JOptionPane.showMessageDialog(this, "Your game files are being updated!"
                    + "\nWhen complete, you can run your project.");
            if (!UpdateManager.downloadInProgress()) UpdateManager.downloadRuntime();
            return;
        } else {
            if (UpdateManager.editorUpdate()) {
                JOptionPane.showMessageDialog(this, "An update is available for your editor!"
                    + "\nIf you have any issues with this test, try downloading it\n"
                        + "via the Help menu.");
            }
        }
        
        try {
            //Scene.DOWNLOAD_THREAD.download("https://computerology.bitbucket.io/index.html", "C:/Users/Jeremy/Desktop/index.html");
            GUI.statusIndicator.setText("Starting game...");
            //start the runtime jar and pass in the project directory and the name of the level to start in
            //you will need to update this in the runtime jar when you reach that point

            String cmd = "java -jar \"" + Assets.USER_HOME + "\\.pengine\\jars\\runtime.jar\" " 
                    + "\""+Project.getProject().getDirectory()+"\""
                    + " \""+(level_name != null ? level_name : "")+"\"";
            System.out.println(cmd);

            Process p = Runtime.getRuntime()
                    .exec(cmd);
            BufferedReader reader
                    = new BufferedReader(new InputStreamReader(p.getInputStream()));
            window.setVisible(false);
            //log the runtime's output
            System.out.println("---START OF GAME OUTPUT---");
            String results = "", line = "";
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
                results += line + "\n";
            }
            System.out.println("---END OF GAME OUTPUT---");
            resultsTextBox.setText(results);
            window.setVisible(true);
            window.toFront();
            showDialog(testOutputDialog);
            GUI.statusIndicator.setText("");
        } catch (IOException ex) {
            //Logger.getLogger(GUI.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        try {
            // select Look and Feel
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (Exception ex) {
            ex.printStackTrace();
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {

                window = new GUI();
                window.setVisible(true);
                window.setSize(750, 500);
                window.setExtendedState(java.awt.Frame.MAXIMIZED_BOTH);
                
                galleryObjectPanel.setVisible(false);

                Assets.mkdirs();
                Project.newProject("", true, true);
                Project.getProject().autoName();
                Assets.load();
                
                UpdateManager.checkForUpdates();
                if (UpdateManager.editorUpdate()) {
                    JOptionPane.showMessageDialog(window, "A newer version of the level editor has been found!"
                        + "\nGo to 'Help' then 'Visit website' to download it.");
                }
                if (UpdateManager.runtimeUpdate()) {
                    UpdateManager.downloadRuntime();
                }

                updateWindowTitle();
                sceneCanvas.repaint();

                JOptionPane.showMessageDialog(window, "Welcome, " + System.getProperty("user.name") + "!\n"
                        + "A blank project has been created for you. You can load previous\n"
                        + "projects using the Project menu.\n");

            }
        });

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private static JButton addBlockButton;
    private static JButton addFrameButton;
    JMenuItem ambientSoundVolumeMenuItem;
    private static AnimationCanvas animationCanvas;
    private static JComboBox<String> animationChooser;
    private static JButton animationSpeedButton;
    private static JButton animationSpriteButton;
    private static JCheckBoxMenuItem autoplayAmbientSoundMenuItem;
    private static JCheckBoxMenuItem autoplayBGMusicMenuItem;
    JPanel basicOptionsPanel;
    private static JComboBox<String> blockInputChooser;
    private static JComboBox<String> blockOutputChooser;
    JMenuItem bottomColorMenuItem;
    public static JButton bringForwardButton;
    JMenuItem cameraLocationMenuItem;
    private static JButton changeObjectNameButton;
    private static JButton changeObjectTextureButton;
    private static JButton changeObjectTypeButton;
    public static JButton cloneObjectButton;
    private static JButton deleteAnimationButton;
    private static JButton deleteBlockButton;
    private static JButton deleteFlowButton;
    private static JButton deleteGalleryObjectButton;
    JButton deleteLevelButton;
    private static JButton deleteObjectButton;
    JButton editLevelButton;
    public static JButton editObjectButton;
    JMenu fileMenu;
    private static FlowCanvas flowCanvas;
    private static JComboBox<String> flowChooser;
    private static JLabel frameCountLabel;
    private static JComboBox<String> galleryObjectChooser;
    private static JPanel galleryObjectPanel;
    JButton jButton1;
    JCheckBox jCheckBox1;
    JLabel jLabel1;
    JLabel jLabel2;
    JLabel jLabel3;
    JLabel jLabel4;
    JLabel jLabel5;
    JLabel jLabel6;
    JLabel jLabel7;
    JLabel jLabel8;
    JMenu jMenu1;
    JMenu jMenu2;
    JMenu jMenu3;
    JMenuItem jMenuItem1;
    JMenuItem jMenuItem10;
    JMenuItem jMenuItem2;
    JMenuItem jMenuItem3;
    JMenuItem jMenuItem4;
    JMenuItem jMenuItem5;
    JMenuItem jMenuItem6;
    JMenuItem jMenuItem7;
    JMenuItem jMenuItem8;
    JMenuItem jMenuItem9;
    JPanel jPanel13;
    JPanel jPanel5;
    JPanel jPanel6;
    JPanel jPanel7;
    JPanel jPanel8;
    JPanel jPanel9;
    JScrollPane jScrollPane1;
    JScrollPane jScrollPane9;
    JPopupMenu.Separator jSeparator4;
    JPopupMenu.Separator jSeparator5;
    JPopupMenu.Separator jSeparator6;
    JMenuItem levelBoundsMenuItem;
    private static JComboBox<String> levelChooser;
    JMenuItem levelManagerButton;
    public static JDialog levelManagerDialog;
    JMenu levelMenu;
    JMenuItem lightingColorMenuItem;
    private static JToggleButton lockAnimationButton;
    private static JToggleButton lockCollidesButton;
    private static JToggleButton lockFlowButton;
    private static JToggleButton lockGravityButton;
    private static JToggleButton lockTextureButton;
    private static JCheckBoxMenuItem loopAmbientSoundMenuItem;
    private static JCheckBoxMenuItem loopBGMusicMenuItem;
    public static JMenuBar menuBar;
    JMenuItem musicVolumeMenuItem;
    private static JButton newAnimationButton;
    private static JButton newFlowButton;
    private static JButton newGalleryObjectButton;
    JMenuItem newLevelButton;
    public static JButton newObjectButton;
    JMenuItem newProjectButton;
    private static JCheckBox objectCollidesCheckbox;
    private static JFrame objectEditor;
    private static JTabbedPane objectEditorTabs;
    JMenuItem objectGalleryButton;
    private static JCheckBox objectGravityCheckbox;
    public static JComboBox objectLayerChooser;
    private static JTextField objectNameField;
    private static JTextField objectTextureField;
    private static JTextField objectTypeField;
    JMenuItem openAssetsFolderButton;
    JMenuItem openProjectButton;
    private static JToggleButton playAnimationButton;
    public static JButton playButton;
    JMenu projectMenu;
    JMenuItem reloadAssetsButton;
    private static JButton removeFrameButton;
    private static JButton renameAnimationButton;
    private static JButton renameFlowButton;
    JButton renameLevelButton;
    private static JButton renameVariableButton;
    private static JTextArea resultsTextBox;
    JMenuItem saveProjectButton;
    public static SceneCanvas sceneCanvas;
    private static SceneObjectCanvas sceneObjectCanvas;
    JMenuItem selectAmbienceMenuItem;
    JMenuItem selectBGMusic;
    public static JButton sendBackwardsButton;
    private static JButton setBlockInputValue;
    private static JButton setBlockOutputValue;
    private static JButton setHomeButton;
    JMenuItem spawnMenuItem;
    public static JCheckBox startAtCurrentLevelCheckBox;
    public static JMenu statusIndicator;
    public static JDialog testOutputDialog;
    JMenuItem topColorMenuItem;
    JPanel topPanel;
    JTextField valueTestField;
    private static JPanel valueTestPanel;
    private static JList<String> variablesList;
    private static JPanel variablesPanel;
    JMenuItem viewRootButton;
    // End of variables declaration//GEN-END:variables
}
