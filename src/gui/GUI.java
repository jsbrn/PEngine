package gui;

import java.awt.Color;
import java.awt.Component;
import java.awt.Cursor;
import java.awt.Desktop;
import java.awt.Dialog;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Image;
import java.awt.Rectangle;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseWheelEvent;
import java.awt.event.MouseWheelListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.event.WindowFocusListener;
import java.awt.image.BufferedImage;
import java.awt.image.RasterFormatException;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.MalformedURLException;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
import java.util.ArrayList;
import java.util.Random;
import java.util.logging.Logger;
import javax.swing.AbstractListModel;
import javax.swing.BorderFactory;
import javax.swing.DefaultComboBoxModel;
import javax.swing.GroupLayout;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JColorChooser;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JToggleButton;
import javax.swing.KeyStroke;
import javax.swing.LayoutStyle;
import javax.swing.UIManager;
import javax.swing.WindowConstants;
import javax.swing.border.BevelBorder;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import misc.Assets;
import misc.MiscMath;
import project.objects.components.Animation;
import project.objects.components.Block;
import project.objects.components.Flow;
import threads.UpdateManager;
import project.Level;
import project.Project;
import project.objects.SceneObject;

public class GUI extends javax.swing.JFrame {

    static GUI window;

    /**
     * Creates new form First
     */
    public GUI() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        testOutputDialog = new JDialog();
        jScrollPane9 = new JScrollPane();
        resultsTextBox = new JTextArea();
        levelManagerDialog = new JDialog();
        jScrollPane12 = new JScrollPane();
        levelList = new JList();
        deleteLevelButton = new JButton();
        editLevelButton = new JButton();
        levelNameField = new JTextField();
        jLabel21 = new JLabel();
        renameLevelButton = new JButton();
        objectEditor = new JFrame();
        galleryObjectPanel = new JPanel();
        galleryObjectChooser = new JComboBox<>();
        newGalleryObjectButton = new JButton();
        deleteGalleryObjectButton = new JButton();
        jLabel3 = new JLabel();
        jLabel4 = new JLabel();
        objectEditorTabs = new JTabbedPane();
        sceneObjectCanvas = new SceneObjectCanvas();
        basicOptionsPanel = new JPanel();
        objectGravityCheckbox = new JCheckBox();
        objectCollidesCheckbox = new JCheckBox();
        changeObjectTypeButton = new JButton();
        changeObjectNameButton = new JButton();
        changeObjectTextureButton = new JButton();
        objectTypeField = new JTextField();
        objectNameField = new JTextField();
        objectTextureField = new JTextField();
        lockTextureButton = new JToggleButton();
        lockGravityButton = new JToggleButton();
        lockCollidesButton = new JToggleButton();
        flowCanvas = new FlowCanvas();
        animationCanvas = new AnimationCanvas();
        jPanel8 = new JPanel();
        animationChooser = new JComboBox<>();
        newAnimationButton = new JButton();
        deleteAnimationButton = new JButton();
        renameAnimationButton = new JButton();
        animationSpeedButton = new JButton();
        animationSpriteButton = new JButton();
        lockAnimationButton = new JToggleButton();
        jPanel6 = new JPanel();
        addFrameButton = new JButton();
        removeFrameButton = new JButton();
        playAnimationButton = new JToggleButton();
        frameCountLabel = new JLabel();
        jMenuItem2 = new JMenuItem();
        sceneCanvas = new SceneCanvas();
        jPanel13 = new JPanel();
        playButton = new JButton();
        startAtCurrentLevelCheckBox = new JCheckBox();
        topPanel = new JPanel();
        bringForwardButton = new JButton();
        sendBackwardsButton = new JButton();
        cloneObjectButton = new JButton();
        editObjectButton = new JButton();
        objectLayerChooser = new JComboBox();
        newObjectButton = new JButton();
        jLabel1 = new JLabel();
        deleteObjectButton = new JButton();
        jPanel5 = new JPanel();
        jCheckBox1 = new JCheckBox();
        jLabel2 = new JLabel();
        menuBar = new JMenuBar();
        fileMenu = new JMenu();
        newProjectButton = new JMenuItem();
        openProjectButton = new JMenuItem();
        saveProjectButton = new JMenuItem();
        projectMenu = new JMenu();
        newLevelButton = new JMenuItem();
        levelManagerButton = new JMenuItem();
        jSeparator5 = new JPopupMenu.Separator();
        objectGalleryButton = new JMenuItem();
        jSeparator6 = new JPopupMenu.Separator();
        reloadAssetsButton = new JMenuItem();
        openAssetsFolderButton = new JMenuItem();
        jSeparator4 = new JPopupMenu.Separator();
        viewRootButton = new JMenuItem();
        levelMenu = new JMenu();
        spawnMenuItem = new JMenuItem();
        cameraLocationMenuItem = new JMenuItem();
        jMenuItem1 = new JMenuItem();
        levelBoundsMenuItem = new JMenuItem();
        jMenu2 = new JMenu();
        topColorMenuItem = new JMenuItem();
        bottomColorMenuItem = new JMenuItem();
        lightingColorMenuItem = new JMenuItem();
        jMenuItem3 = new JMenuItem();
        jMenu1 = new JMenu();
        jMenuItem8 = new JMenuItem();
        selectBGMusic = new JMenuItem();
        loopBGMusicMenuItem = new JCheckBoxMenuItem();
        autoplayBGMusicMenuItem = new JCheckBoxMenuItem();
        musicVolumeMenuItem = new JMenuItem();
        jMenuItem9 = new JMenuItem();
        selectAmbienceMenuItem = new JMenuItem();
        loopAmbientSoundMenuItem = new JCheckBoxMenuItem();
        autoplayAmbientSoundMenuItem = new JCheckBoxMenuItem();
        ambientSoundVolumeMenuItem = new JMenuItem();
        jMenu3 = new JMenu();
        jMenuItem5 = new JMenuItem();
        jMenuItem6 = new JMenuItem();
        jMenuItem4 = new JMenuItem();
        statusIndicator = new JMenu();

        testOutputDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        testOutputDialog.setTitle("Game output");
        testOutputDialog.setBounds(new Rectangle(0, 0, 600, 490));
        testOutputDialog.setMinimumSize(new Dimension(400, 490));
        testOutputDialog.setModalExclusionType(Dialog.ModalExclusionType.APPLICATION_EXCLUDE);
        testOutputDialog.setResizable(false);
        testOutputDialog.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                genericDialogWindowClosing(evt);
            }
        });

        resultsTextBox.setColumns(20);
        resultsTextBox.setLineWrap(true);
        resultsTextBox.setRows(5);
        jScrollPane9.setViewportView(resultsTextBox);

        GroupLayout testOutputDialogLayout = new GroupLayout(testOutputDialog.getContentPane());
        testOutputDialog.getContentPane().setLayout(testOutputDialogLayout);
        testOutputDialogLayout.setHorizontalGroup(testOutputDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(testOutputDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane9, GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE)
                .addContainerGap())
        );
        testOutputDialogLayout.setVerticalGroup(testOutputDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(testOutputDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane9, GroupLayout.DEFAULT_SIZE, 416, Short.MAX_VALUE)
                .addContainerGap())
        );

        levelManagerDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        levelManagerDialog.setTitle("Choose a level...");
        levelManagerDialog.setBounds(new Rectangle(300, 300, 356, 270));
        levelManagerDialog.setModalExclusionType(Dialog.ModalExclusionType.APPLICATION_EXCLUDE);
        levelManagerDialog.setResizable(false);
        levelManagerDialog.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                genericDialogWindowClosing(evt);
            }
            public void windowOpened(WindowEvent evt) {
                levelManagerDialogWindowOpened(evt);
            }
        });

        levelList.setModel(new AbstractListModel() {
            String[] strings = { "Item 1", "Item 2", "Item 3", "Item 4", "Item 5" };
            public int getSize() { return strings.length; }
            public Object getElementAt(int i) { return strings[i]; }
        });
        levelList.addListSelectionListener(new ListSelectionListener() {
            public void valueChanged(ListSelectionEvent evt) {
                levelListValueChanged(evt);
            }
        });
        jScrollPane12.setViewportView(levelList);

        deleteLevelButton.setText("Delete");
        deleteLevelButton.setEnabled(false);
        deleteLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteLevelButtonActionPerformed(evt);
            }
        });

        editLevelButton.setText("Edit!");
        editLevelButton.setEnabled(false);
        editLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                editLevelButtonActionPerformed(evt);
            }
        });

        levelNameField.setEnabled(false);

        jLabel21.setText("Name:");

        renameLevelButton.setText("Rename");
        renameLevelButton.setEnabled(false);
        renameLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameLevelButtonActionPerformed(evt);
            }
        });

        GroupLayout levelManagerDialogLayout = new GroupLayout(levelManagerDialog.getContentPane());
        levelManagerDialog.getContentPane().setLayout(levelManagerDialogLayout);
        levelManagerDialogLayout.setHorizontalGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(levelManagerDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane12)
                    .addGroup(levelManagerDialogLayout.createSequentialGroup()
                        .addComponent(editLevelButton, GroupLayout.DEFAULT_SIZE, 267, Short.MAX_VALUE)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(deleteLevelButton))
                    .addGroup(levelManagerDialogLayout.createSequentialGroup()
                        .addComponent(jLabel21)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(levelNameField)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(renameLevelButton)))
                .addContainerGap())
        );
        levelManagerDialogLayout.setVerticalGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(levelManagerDialogLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane12, GroupLayout.PREFERRED_SIZE, 155, GroupLayout.PREFERRED_SIZE)
                .addGap(3, 3, 3)
                .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel21)
                    .addComponent(levelNameField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(renameLevelButton))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(levelManagerDialogLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(deleteLevelButton)
                    .addComponent(editLevelButton))
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        objectEditor.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        objectEditor.setBounds(new Rectangle(0, 0, 700, 500));
        objectEditor.setMinimumSize(new Dimension(700, 500));
        objectEditor.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                objectEditorWindowClosing(evt);
            }
        });

        galleryObjectPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        galleryObjectChooser.setModel(new DefaultComboBoxModel<>(new String[] { "Player" }));
        galleryObjectChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                galleryObjectChooserActionPerformed(evt);
            }
        });

        newGalleryObjectButton.setText("New object...");
        newGalleryObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newGalleryObjectButtonActionPerformed(evt);
            }
        });

        deleteGalleryObjectButton.setText("Delete object");
        deleteGalleryObjectButton.setEnabled(false);
        deleteGalleryObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteGalleryObjectButtonActionPerformed(evt);
            }
        });

        jLabel3.setText("Gallery object:");

        jLabel4.setFont(new Font("Tahoma", 1, 11)); // NOI18N
        jLabel4.setText("Object Gallery");

        GroupLayout galleryObjectPanelLayout = new GroupLayout(galleryObjectPanel);
        galleryObjectPanel.setLayout(galleryObjectPanelLayout);
        galleryObjectPanelLayout.setHorizontalGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(galleryObjectPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel4)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel3)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(galleryObjectChooser, GroupLayout.PREFERRED_SIZE, 235, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(newGalleryObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteGalleryObjectButton)
                .addContainerGap())
        );
        galleryObjectPanelLayout.setVerticalGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(galleryObjectPanelLayout.createSequentialGroup()
                .addGap(4, 4, 4)
                .addGroup(galleryObjectPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(galleryObjectChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(newGalleryObjectButton)
                    .addComponent(deleteGalleryObjectButton)
                    .addComponent(jLabel3)
                    .addComponent(jLabel4))
                .addGap(3, 3, 3))
        );

        basicOptionsPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        objectGravityCheckbox.setText("Gravity");
        objectGravityCheckbox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectGravityCheckboxActionPerformed(evt);
            }
        });

        objectCollidesCheckbox.setText("Collides");
        objectCollidesCheckbox.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectCollidesCheckboxActionPerformed(evt);
            }
        });

        changeObjectTypeButton.setText("Change type...");
        changeObjectTypeButton.setActionCommand("c");
        changeObjectTypeButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        changeObjectNameButton.setText("Change name...");
        changeObjectNameButton.setActionCommand("n");
        changeObjectNameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        changeObjectTextureButton.setText("Change texture...");
        changeObjectTextureButton.setActionCommand("t");
        changeObjectTextureButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                changeObjectProperty(evt);
            }
        });

        objectTypeField.setEditable(false);

        objectNameField.setEditable(false);

        objectTextureField.setEditable(false);

        lockTextureButton.setText("ðŸ”’");
        lockTextureButton.setActionCommand("0");
        lockTextureButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        lockGravityButton.setText("ðŸ”’");
        lockGravityButton.setActionCommand("1");
        lockGravityButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        lockCollidesButton.setText("ðŸ”’");
        lockCollidesButton.setActionCommand("2");
        lockCollidesButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        GroupLayout basicOptionsPanelLayout = new GroupLayout(basicOptionsPanel);
        basicOptionsPanel.setLayout(basicOptionsPanelLayout);
        basicOptionsPanelLayout.setHorizontalGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                        .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.TRAILING, false)
                            .addComponent(changeObjectTypeButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(changeObjectNameButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(changeObjectTextureButton, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.TRAILING, false)
                            .addComponent(objectNameField, GroupLayout.Alignment.LEADING, GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
                            .addComponent(objectTextureField)
                            .addComponent(objectTypeField, GroupLayout.Alignment.LEADING))
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockTextureButton))
                    .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                        .addGap(2, 2, 2)
                        .addComponent(objectGravityCheckbox)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockGravityButton)
                        .addGap(18, 18, 18)
                        .addComponent(objectCollidesCheckbox)
                        .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lockCollidesButton)))
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        basicOptionsPanelLayout.setVerticalGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(basicOptionsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectTypeButton)
                    .addComponent(objectTypeField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectNameButton)
                    .addComponent(objectNameField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(changeObjectTextureButton)
                    .addComponent(objectTextureField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(lockTextureButton))
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(basicOptionsPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                        .addComponent(objectCollidesCheckbox)
                        .addComponent(lockCollidesButton))
                    .addComponent(lockGravityButton)
                    .addComponent(objectGravityCheckbox))
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        GroupLayout sceneObjectCanvasLayout = new GroupLayout(sceneObjectCanvas);
        sceneObjectCanvas.setLayout(sceneObjectCanvasLayout);
        sceneObjectCanvasLayout.setHorizontalGroup(sceneObjectCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneObjectCanvasLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(basicOptionsPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(385, Short.MAX_VALUE))
        );
        sceneObjectCanvasLayout.setVerticalGroup(sceneObjectCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneObjectCanvasLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(basicOptionsPanel, GroupLayout.PREFERRED_SIZE, 133, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(294, Short.MAX_VALUE))
        );

        objectEditorTabs.addTab("Basics", sceneObjectCanvas);

        GroupLayout flowCanvasLayout = new GroupLayout(flowCanvas);
        flowCanvas.setLayout(flowCanvasLayout);
        flowCanvasLayout.setHorizontalGroup(flowCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGap(0, 745, Short.MAX_VALUE)
        );
        flowCanvasLayout.setVerticalGroup(flowCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGap(0, 438, Short.MAX_VALUE)
        );

        objectEditorTabs.addTab("Logic", flowCanvas);

        animationChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationChooserActionPerformed(evt);
            }
        });

        newAnimationButton.setText("New");
        newAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newAnimationButtonActionPerformed(evt);
            }
        });

        deleteAnimationButton.setText("Delete");
        deleteAnimationButton.setEnabled(false);
        deleteAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteAnimationButtonActionPerformed(evt);
            }
        });

        renameAnimationButton.setText("Rename...");
        renameAnimationButton.setEnabled(false);
        renameAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                renameAnimationButtonActionPerformed(evt);
            }
        });

        animationSpeedButton.setText("Speed...");
        animationSpeedButton.setEnabled(false);
        animationSpeedButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationSpeedButtonActionPerformed(evt);
            }
        });

        animationSpriteButton.setText("Spritesheet...");
        animationSpriteButton.setEnabled(false);
        animationSpriteButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                animationSpriteButtonActionPerformed(evt);
            }
        });

        lockAnimationButton.setText("ðŸ”’");
        lockAnimationButton.setActionCommand("a");
        lockAnimationButton.setEnabled(false);
        lockAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lockTextureButtonActionPerformed(evt);
            }
        });

        GroupLayout jPanel8Layout = new GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(newAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationChooser, GroupLayout.PREFERRED_SIZE, 150, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lockAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(renameAnimationButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationSpriteButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(animationSpeedButton)
                .addContainerGap(83, Short.MAX_VALUE))
        );
        jPanel8Layout.setVerticalGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel8Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(animationChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(newAnimationButton)
                    .addComponent(deleteAnimationButton)
                    .addComponent(renameAnimationButton)
                    .addComponent(animationSpeedButton)
                    .addComponent(animationSpriteButton)
                    .addComponent(lockAnimationButton))
                .addGap(5, 5, 5))
        );

        addFrameButton.setText("+");
        addFrameButton.setActionCommand("1");
        addFrameButton.setEnabled(false);
        addFrameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                addFrameButtonActionPerformed(evt);
            }
        });

        removeFrameButton.setText("-");
        removeFrameButton.setActionCommand("-1");
        removeFrameButton.setEnabled(false);
        removeFrameButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                addFrameButtonActionPerformed(evt);
            }
        });

        playAnimationButton.setText("â–º");
        playAnimationButton.setEnabled(false);
        playAnimationButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                playAnimationButtonActionPerformed(evt);
            }
        });

        frameCountLabel.setText("Frame count: 1");

        GroupLayout jPanel6Layout = new GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(addFrameButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(removeFrameButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(frameCountLabel)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(playAnimationButton, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, jPanel6Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addGroup(jPanel6Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(addFrameButton)
                    .addComponent(removeFrameButton)
                    .addComponent(playAnimationButton)
                    .addComponent(frameCountLabel))
                .addGap(5, 5, 5))
        );

        GroupLayout animationCanvasLayout = new GroupLayout(animationCanvas);
        animationCanvas.setLayout(animationCanvasLayout);
        animationCanvasLayout.setHorizontalGroup(animationCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(jPanel8, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel6, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        animationCanvasLayout.setVerticalGroup(animationCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(animationCanvasLayout.createSequentialGroup()
                .addComponent(jPanel8, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 366, Short.MAX_VALUE)
                .addComponent(jPanel6, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        );

        objectEditorTabs.addTab("Animations", animationCanvas);

        GroupLayout objectEditorLayout = new GroupLayout(objectEditor.getContentPane());
        objectEditor.getContentPane().setLayout(objectEditorLayout);
        objectEditorLayout.setHorizontalGroup(objectEditorLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(objectEditorTabs, GroupLayout.DEFAULT_SIZE, 700, Short.MAX_VALUE)
            .addComponent(galleryObjectPanel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        objectEditorLayout.setVerticalGroup(objectEditorLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, objectEditorLayout.createSequentialGroup()
                .addComponent(galleryObjectPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(objectEditorTabs))
        );

        jMenuItem2.setText("jMenuItem2");

        setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("PlatformR Engine");
        setBackground(new Color(1, 1, 1));
        setBounds(new Rectangle(150, 150, 1000, 600));
        setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
        setMinimumSize(new Dimension(700, 330));
        setModalExclusionType(null);
        setName("windowFrame"); // NOI18N
        addWindowFocusListener(new WindowFocusListener() {
            public void windowGainedFocus(WindowEvent evt) {
                formWindowGainedFocus(evt);
            }
            public void windowLostFocus(WindowEvent evt) {
            }
        });
        addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        sceneCanvas.addMouseMotionListener(new MouseMotionAdapter() {
            public void mouseDragged(MouseEvent evt) {
                sceneCanvasMouseDragged(evt);
            }
            public void mouseMoved(MouseEvent evt) {
                sceneCanvasMouseMoved(evt);
            }
        });
        sceneCanvas.addMouseWheelListener(new MouseWheelListener() {
            public void mouseWheelMoved(MouseWheelEvent evt) {
                sceneCanvasMouseWheelMoved(evt);
            }
        });
        sceneCanvas.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent evt) {
                sceneCanvasMouseClicked(evt);
            }
        });
        sceneCanvas.addPropertyChangeListener(new PropertyChangeListener() {
            public void propertyChange(PropertyChangeEvent evt) {
                sceneCanvasPropertyChange(evt);
                sceneCanvasPropertyChange1(evt);
            }
        });
        sceneCanvas.addKeyListener(new KeyAdapter() {
            public void keyPressed(KeyEvent evt) {
                sceneCanvasKeyPressed(evt);
            }
        });

        jPanel13.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        playButton.setMnemonic('R');
        playButton.setText("â–º");
        playButton.setDoubleBuffered(true);
        playButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                playButtonActionPerformed(evt);
            }
        });

        startAtCurrentLevelCheckBox.setText("Start at current level");
        startAtCurrentLevelCheckBox.setDoubleBuffered(true);

        GroupLayout jPanel13Layout = new GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(startAtCurrentLevelCheckBox)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 6, Short.MAX_VALUE)
                .addComponent(playButton, GroupLayout.PREFERRED_SIZE, 53, GroupLayout.PREFERRED_SIZE))
        );
        jPanel13Layout.setVerticalGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                .addComponent(playButton, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE)
                .addComponent(startAtCurrentLevelCheckBox, GroupLayout.PREFERRED_SIZE, 45, GroupLayout.PREFERRED_SIZE))
        );

        topPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        bringForwardButton.setText("â†‘");
        bringForwardButton.setToolTipText("Send forward");
        bringForwardButton.setActionCommand("f");
        bringForwardButton.setEnabled(false);
        bringForwardButton.setMaximumSize(new Dimension(85, 23));
        bringForwardButton.setMinimumSize(new Dimension(85, 23));
        bringForwardButton.setPreferredSize(new Dimension(85, 23));
        bringForwardButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                moveZAction(evt);
            }
        });

        sendBackwardsButton.setText("â†“");
        sendBackwardsButton.setToolTipText("Send backwards");
        sendBackwardsButton.setActionCommand("b");
        sendBackwardsButton.setEnabled(false);
        sendBackwardsButton.setMaximumSize(new Dimension(85, 23));
        sendBackwardsButton.setPreferredSize(new Dimension(85, 23));
        sendBackwardsButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                moveZAction(evt);
            }
        });

        cloneObjectButton.setText("Clone");
        cloneObjectButton.setActionCommand("c");
        cloneObjectButton.setEnabled(false);
        cloneObjectButton.setPreferredSize(new Dimension(85, 23));
        cloneObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnObjectAction(evt);
            }
        });

        editObjectButton.setText("Edit");
        editObjectButton.setEnabled(false);
        editObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                editObjectButtonActionPerformed(evt);
            }
        });

        objectLayerChooser.setModel(new DefaultComboBoxModel(new String[] {"Distance", "Background", "Normal", "Foreground"}));
        objectLayerChooser.setToolTipText("Choose the layer the object lies in");
        objectLayerChooser.setEnabled(false);
        objectLayerChooser.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectLayerChooserActionPerformed(evt);
            }
        });
        objectLayerChooser.setSelectedIndex(-1);

        newObjectButton.setMnemonic('N');
        newObjectButton.setText("New...");
        newObjectButton.setActionCommand("n");
        newObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnObjectAction(evt);
            }
        });

        jLabel1.setText("Layer:");

        deleteObjectButton.setText("Delete");
        deleteObjectButton.setEnabled(false);
        deleteObjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                deleteObjectButtonActionPerformed(evt);
            }
        });

        GroupLayout topPanelLayout = new GroupLayout(topPanel);
        topPanel.setLayout(topPanelLayout);
        topPanelLayout.setHorizontalGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(topPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(newObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(editObjectButton)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cloneObjectButton, GroupLayout.PREFERRED_SIZE, 61, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(deleteObjectButton)
                .addGap(18, 18, 18)
                .addComponent(jLabel1)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(objectLayerChooser, GroupLayout.PREFERRED_SIZE, 250, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(bringForwardButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sendBackwardsButton, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
                .addContainerGap(133, Short.MAX_VALUE))
        );
        topPanelLayout.setVerticalGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(topPanelLayout.createSequentialGroup()
                .addGap(3, 3, 3)
                .addGroup(topPanelLayout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(cloneObjectButton, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(newObjectButton)
                    .addComponent(editObjectButton)
                    .addComponent(bringForwardButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(sendBackwardsButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(objectLayerChooser, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1)
                    .addComponent(deleteObjectButton))
                .addGap(3, 3, 3))
        );

        jPanel5.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED));

        jCheckBox1.setText("Show grid");
        jCheckBox1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });

        jLabel2.setFont(new Font("Tahoma", 1, 11)); // NOI18N
        jLabel2.setText("Canvas settings");

        GroupLayout jPanel5Layout = new GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addGap(0, 22, Short.MAX_VALUE))
                    .addComponent(jCheckBox1, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(jPanel5Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jCheckBox1)
                .addContainerGap(GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        GroupLayout sceneCanvasLayout = new GroupLayout(sceneCanvas);
        sceneCanvas.setLayout(sceneCanvasLayout);
        sceneCanvasLayout.setHorizontalGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(topPanel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(GroupLayout.Alignment.TRAILING, sceneCanvasLayout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel5, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel13, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        sceneCanvasLayout.setVerticalGroup(sceneCanvasLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(sceneCanvasLayout.createSequentialGroup()
                .addComponent(topPanel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel5, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 409, Short.MAX_VALUE)
                .addComponent(jPanel13, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        fileMenu.setText("File");

        newProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_P, InputEvent.CTRL_MASK));
        newProjectButton.setText("New project...");
        newProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(newProjectButton);

        openProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.CTRL_MASK));
        openProjectButton.setText("Open existing project...");
        openProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                openProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(openProjectButton);

        saveProjectButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.CTRL_MASK));
        saveProjectButton.setText("Save project...");
        saveProjectButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                saveProjectButtonActionPerformed(evt);
            }
        });
        fileMenu.add(saveProjectButton);

        menuBar.add(fileMenu);

        projectMenu.setText("Project");
        projectMenu.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                projectMenuActionPerformed(evt);
            }
        });

        newLevelButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_L, InputEvent.CTRL_MASK));
        newLevelButton.setText("New level");
        newLevelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                newLevelButtonActionPerformed(evt);
            }
        });
        projectMenu.add(newLevelButton);

        levelManagerButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_L, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));
        levelManagerButton.setText("Open level manager...");
        levelManagerButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                levelManagerButtonActionPerformed(evt);
            }
        });
        projectMenu.add(levelManagerButton);
        projectMenu.add(jSeparator5);

        objectGalleryButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));
        objectGalleryButton.setText("Open object gallery...");
        objectGalleryButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                objectGalleryButtonActionPerformed(evt);
            }
        });
        projectMenu.add(objectGalleryButton);
        projectMenu.add(jSeparator6);

        reloadAssetsButton.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F5, 0));
        reloadAssetsButton.setText("Reload project assets");
        reloadAssetsButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                reloadAssetsButtonActionPerformed(evt);
            }
        });
        projectMenu.add(reloadAssetsButton);

        openAssetsFolderButton.setText("Open assets folder");
        openAssetsFolderButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                openAssetsFolderButtonActionPerformed(evt);
            }
        });
        projectMenu.add(openAssetsFolderButton);
        projectMenu.add(jSeparator4);

        viewRootButton.setText("View root directory...");
        viewRootButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                viewRootButtonActionPerformed(evt);
            }
        });
        projectMenu.add(viewRootButton);

        menuBar.add(projectMenu);

        levelMenu.setText("Level");

        spawnMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        spawnMenuItem.setText("Spawn point...");
        spawnMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                spawnMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(spawnMenuItem);

        cameraLocationMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        cameraLocationMenuItem.setText("Camera location...");
        cameraLocationMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                cameraLocationMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(cameraLocationMenuItem);

        jMenuItem1.setText("Camera zoom...");
        jMenuItem1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        levelMenu.add(jMenuItem1);

        levelBoundsMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_B, InputEvent.ALT_MASK | InputEvent.CTRL_MASK));
        levelBoundsMenuItem.setText("Bounds...");
        levelBoundsMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                levelBoundsMenuItemActionPerformed(evt);
            }
        });
        levelMenu.add(levelBoundsMenuItem);

        jMenu2.setText("Lighting");

        topColorMenuItem.setText("Background color (top)...");
        topColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                topColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(topColorMenuItem);

        bottomColorMenuItem.setText("Background color (bottom)...");
        bottomColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                bottomColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(bottomColorMenuItem);

        lightingColorMenuItem.setText("Ambience color...");
        lightingColorMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                lightingColorMenuItemActionPerformed(evt);
            }
        });
        jMenu2.add(lightingColorMenuItem);

        jMenuItem3.setText("Ambience intensity...");
        jMenuItem3.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem3ActionPerformed(evt);
            }
        });
        jMenu2.add(jMenuItem3);

        levelMenu.add(jMenu2);

        jMenu1.setText("Audio");

        jMenuItem8.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem8.setText("Music");
        jMenuItem8.setEnabled(false);
        jMenu1.add(jMenuItem8);

        selectBGMusic.setText("Select track...");
        selectBGMusic.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                selectBGMusicActionPerformed(evt);
            }
        });
        jMenu1.add(selectBGMusic);

        loopBGMusicMenuItem.setSelected(true);
        loopBGMusicMenuItem.setText("Loop");
        loopBGMusicMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                loopBGMusicMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(loopBGMusicMenuItem);

        autoplayBGMusicMenuItem.setSelected(true);
        autoplayBGMusicMenuItem.setText("Autoplay");
        autoplayBGMusicMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                autoplayBGMusicMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(autoplayBGMusicMenuItem);

        musicVolumeMenuItem.setText("Volume...");
        musicVolumeMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                musicVolumeMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(musicVolumeMenuItem);

        jMenuItem9.setFont(new Font("Segoe UI", 1, 12)); // NOI18N
        jMenuItem9.setText("Ambient sounds");
        jMenuItem9.setEnabled(false);
        jMenu1.add(jMenuItem9);

        selectAmbienceMenuItem.setText("Select track...");
        selectAmbienceMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                selectAmbienceMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(selectAmbienceMenuItem);

        loopAmbientSoundMenuItem.setSelected(true);
        loopAmbientSoundMenuItem.setText("Loop");
        loopAmbientSoundMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                loopAmbientSoundMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(loopAmbientSoundMenuItem);

        autoplayAmbientSoundMenuItem.setSelected(true);
        autoplayAmbientSoundMenuItem.setText("Autoplay");
        autoplayAmbientSoundMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                autoplayAmbientSoundMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(autoplayAmbientSoundMenuItem);

        ambientSoundVolumeMenuItem.setText("Volume...");
        ambientSoundVolumeMenuItem.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                ambientSoundVolumeMenuItemActionPerformed(evt);
            }
        });
        jMenu1.add(ambientSoundVolumeMenuItem);

        levelMenu.add(jMenu1);

        menuBar.add(levelMenu);

        jMenu3.setText("Help");

        jMenuItem5.setText("Help topics...");
        jMenu3.add(jMenuItem5);

        jMenuItem6.setText("Check for updates");
        jMenuItem6.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem6ActionPerformed(evt);
            }
        });
        jMenu3.add(jMenuItem6);

        jMenuItem4.setText("Visit website...");
        jMenuItem4.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jMenuItem4ActionPerformed(evt);
            }
        });
        jMenu3.add(jMenuItem4);

        menuBar.add(jMenu3);

        statusIndicator.setEnabled(false);
        statusIndicator.setFont(new Font("Segoe UI", 2, 12)); // NOI18N
        menuBar.add(statusIndicator);

        setJMenuBar(menuBar);

        GroupLayout layout = new GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(sceneCanvas, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(sceneCanvas, GroupLayout.Alignment.TRAILING, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void sceneCanvasMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseReleased

    }//GEN-LAST:event_sceneCanvasMouseReleased

    private void formWindowGainedFocus(WindowEvent evt) {//GEN-FIRST:event_formWindowGainedFocus

    }//GEN-LAST:event_formWindowGainedFocus


    private void formWindowClosing(WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        if (promptSave() == 0) {
            System.exit(0);
        }
    }//GEN-LAST:event_formWindowClosing

    private void saveProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_saveProjectButtonActionPerformed
        while (true) {
            String input = JOptionPane.showInputDialog(this, "Project name:", Project.getProject().getName());
            if (input == null) {
                break;
            }
            input = input.replaceAll("[\\/.,]", "");
            if (Project.projectExists(input)) {
                int overwrite = JOptionPane.showConfirmDialog(this, "A project by that name already exists! Overwrite?",
                        "Careful!",
                        JOptionPane.YES_NO_CANCEL_OPTION);
                if (overwrite == JOptionPane.YES_OPTION) {
                    Project.getProject().setName(input);
                    Project.getProject().save();
                    break;
                }
            } else {
                Project.getProject().setName(input);
                Project.getProject().save();
                break;
            }
        }
        GUI.updateWindowTitle();
        sceneCanvas.repaint();
        GUI.refreshObjectProperties();
        objectEditor.setVisible(false);
    }//GEN-LAST:event_saveProjectButtonActionPerformed

    private void newProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newProjectButtonActionPerformed
        if (promptSave() == 0) {
            while (true) {
                String input = JOptionPane.showInputDialog(this, "Project name:", "New project...", JOptionPane.PLAIN_MESSAGE);
                if (input == null) break;
                input = input.replaceAll("[\\/.,]", "");
                if (Project.projectExists(input)) {
                    JOptionPane.showMessageDialog(this, "Project \"" + input + "\" already exists!",
                            "Whoops!", JOptionPane.ERROR_MESSAGE);
                } else {
                    Project.newProject(input, true, true);
                    break;
                }
            }
            GUI.updateWindowTitle();
            sceneCanvas.resetCamera();
            sceneCanvas.setSelectedObject(null);
            sceneCanvas.repaint();
            GUI.refreshObjectProperties();
            objectEditor.setVisible(false);
        }
    }//GEN-LAST:event_newProjectButtonActionPerformed

    private void newLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newLevelButtonActionPerformed
        Level l = new Level();
        l.autoName();
        Project.getProject().addLevel(l);
        Project.getProject().switchToLevel(l.getName());
        sceneCanvas.resetCamera();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        GUI.updateWindowTitle();
        GUI.refreshObjectProperties();
        GUI.refreshLevelMenu();
    }//GEN-LAST:event_newLevelButtonActionPerformed

    private void levelListValueChanged(ListSelectionEvent evt) {//GEN-FIRST:event_levelListValueChanged
        String selected = ((String) levelList.getSelectedValue());
        System.out.println(selected);
        if (selected != null) {
            levelNameField.setText(selected);
        }
        levelNameField.setEnabled(selected != null);
        editLevelButton.setEnabled(selected != null);
        deleteLevelButton.setEnabled(selected != null);
        renameLevelButton.setEnabled(selected != null);
    }//GEN-LAST:event_levelListValueChanged

    private void deleteLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteLevelButtonActionPerformed
        String selected = ((String) levelList.getSelectedValue());
        int index = levelList.getSelectedIndex();
        if (selected.equals(Project.getProject().getCurrentLevel().getName())) {
            //JOptionPane.showMessageDialog(levelManagerDialog, "This level is being edited and cannot be deleted.");
            JOptionPane.showMessageDialog(levelManagerDialog, "This level is being edited and cannot be deleted.");
            return;
        }
        Project.getProject().deleteLevel(selected);
        GUI.refreshList(levelList, Project.getProject().getLevels());
        levelList.setSelectedIndex(index);
        if (levelList.getSelectedIndex() > levelList.getMaxSelectionIndex()) {
            levelList.setSelectedIndex(levelList.getMaxSelectionIndex());
        } else if (levelList.getSelectedIndex() < levelList.getMinSelectionIndex()) {
            levelList.setSelectedIndex(0);
        }
    }//GEN-LAST:event_deleteLevelButtonActionPerformed

    private void editLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_editLevelButtonActionPerformed
        String selected = ((String) levelList.getSelectedValue());
        if (selected.equals(Project.getProject().getCurrentLevel().getName())) {
            //GUI.showMessage("You are already editing this level!", levelManagerDialog);
            JOptionPane.showMessageDialog(levelManagerDialog, "You are already editing this level!");
            return;
        }
        Project.getProject().switchToLevel(selected);
        GUI.updateWindowTitle();
        GUI.refreshObjectProperties();
        GUI.refreshLevelMenu();
        sceneCanvas.resetCamera();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        hideDialog(levelManagerDialog);
        GUI.updateWindowTitle();
    }//GEN-LAST:event_editLevelButtonActionPerformed

    private void levelManagerButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_levelManagerButtonActionPerformed
        GUI.refreshList(levelList, Project.getProject().getLevels());
        showDialog(levelManagerDialog);
    }//GEN-LAST:event_levelManagerButtonActionPerformed

    private void renameLevelButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameLevelButtonActionPerformed
        int index = levelList.getSelectedIndex();
        ArrayList<Level> list = Project.getProject().getLevels();
        Level l = list.get(index);

        if (l.getName().equals(levelNameField.getText()) == false) {
            if (Project.getProject().containsLevel(levelNameField.getText())) {
                JOptionPane.showMessageDialog(levelManagerDialog, "A level already exists by that name!");
                return;
            }
            l.setName(levelNameField.getText());
            GUI.refreshList(levelList, Project.getProject().getLevels());
            levelList.setSelectedIndex(index);
            levelNameField.grabFocus();
            GUI.updateWindowTitle();
        }

    }//GEN-LAST:event_renameLevelButtonActionPerformed

    private void viewRootButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_viewRootButtonActionPerformed
        File folder = new File(Project.getProject().getDirectory());
        try {
            if (folder.exists()) {
                Desktop.getDesktop().open(folder);
            } else {
                JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
            }
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_viewRootButtonActionPerformed

    private void reloadAssetsButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_reloadAssetsButtonActionPerformed
        if (Project.getProject().existsOnDisk()) {
            Assets.load();
            JOptionPane.showMessageDialog(null, "Successfully loaded "+Assets.assetCount()+" project assets!");
        } else {
            JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
        }

    }//GEN-LAST:event_reloadAssetsButtonActionPerformed

    private void openAssetsFolderButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_openAssetsFolderButtonActionPerformed
        File folder = new File(System.getProperty("user.home") + "/platformr/projects/" + Project.getProject().getName() + "/assets/");
        try {
            if (folder.exists()) {
                Desktop.getDesktop().open(folder);
            } else {
                JOptionPane.showMessageDialog(this, "Project files have not been created!\nSave your project first.");
            }
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_openAssetsFolderButtonActionPerformed

    private void genericDialogWindowClosing(WindowEvent evt) {//GEN-FIRST:event_genericDialogWindowClosing
        if (!(evt.getComponent() instanceof JDialog)) {
            return;
        }
        hideDialog((JDialog) evt.getComponent());
    }//GEN-LAST:event_genericDialogWindowClosing

    private void levelManagerDialogWindowOpened(WindowEvent evt) {//GEN-FIRST:event_levelManagerDialogWindowOpened
        GUI.refreshList(levelList, Project.getProject().getLevels());
    }//GEN-LAST:event_levelManagerDialogWindowOpened

    private void projectMenuActionPerformed(ActionEvent evt) {//GEN-FIRST:event_projectMenuActionPerformed

    }//GEN-LAST:event_projectMenuActionPerformed

    private void objectCollidesCheckboxActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectCollidesCheckboxActionPerformed
        sceneCanvas.getActiveObject().setCollides(!sceneCanvas.getActiveObject().collides());
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_objectCollidesCheckboxActionPerformed

    private void objectGravityCheckboxActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectGravityCheckboxActionPerformed
        sceneCanvas.getActiveObject().setGravity(!sceneCanvas.getActiveObject().gravity());
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_objectGravityCheckboxActionPerformed

    private void objectGalleryButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectGalleryButtonActionPerformed
        sceneCanvas.setActiveObject(Project.getProject().getGalleryObject(0));
        showObjectEditor();
    }//GEN-LAST:event_objectGalleryButtonActionPerformed

    private void openProjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_openProjectButtonActionPerformed
        if (promptSave() == 0) {
            ArrayList<String> spawnList = new ArrayList<String>();
            for (File f : new File(Assets.USER_HOME + "/platformr/projects").listFiles()) {
                if (new File(f.getAbsolutePath() + "/project.txt").exists()) {
                    spawnList.add(f.getName());
                }
            }
            Object selection = JOptionPane.showInputDialog(this, "Choose a project:", "Open project...",
                    JOptionPane.PLAIN_MESSAGE, null, spawnList.toArray(), null);
            if (selection == null) {
                return;
            }
            Project.newProject((String) selection, false, false);
            Project.getProject().load();
        }
        GUI.updateWindowTitle();
        sceneCanvas.setSelectedObject(null);
        sceneCanvas.repaint();
        GUI.refreshObjectProperties();
        hideObjectEditor();
    }//GEN-LAST:event_openProjectButtonActionPerformed

    private void sceneCanvasKeyPressed(KeyEvent evt) {//GEN-FIRST:event_sceneCanvasKeyPressed
        sceneCanvas.handleKeyPress(evt);
    }//GEN-LAST:event_sceneCanvasKeyPressed

    private void sceneCanvasMouseClicked(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseClicked
        sceneCanvas.handleMouseClick(evt);
    }//GEN-LAST:event_sceneCanvasMouseClicked

    private void sceneCanvasMouseWheelMoved(MouseWheelEvent evt) {//GEN-FIRST:event_sceneCanvasMouseWheelMoved
        sceneCanvas.handleMouseWheel(evt);
    }//GEN-LAST:event_sceneCanvasMouseWheelMoved

    private void sceneCanvasMouseMoved(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseMoved
        sceneCanvas.handleMouseMovement(evt);
    }//GEN-LAST:event_sceneCanvasMouseMoved

    private void sceneCanvasMouseDragged(MouseEvent evt) {//GEN-FIRST:event_sceneCanvasMouseDragged
        sceneCanvas.handleMouseDrag(evt);
    }//GEN-LAST:event_sceneCanvasMouseDragged

    private void objectLayerChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_objectLayerChooserActionPerformed
        if (sceneCanvas.getSelectedObject() == null) return;
        Project.getProject().getCurrentLevel().moveToLayer(1 + objectLayerChooser.getSelectedIndex(), sceneCanvas.getSelectedObject());
        sceneCanvas.repaint();
    }//GEN-LAST:event_objectLayerChooserActionPerformed

    private void editObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_editObjectButtonActionPerformed
        sceneCanvas.setActiveObject(sceneCanvas.getSelectedObject());
        GUI.refreshObjectEditor();
        showObjectEditor();
    }//GEN-LAST:event_editObjectButtonActionPerformed

    private void spawnObjectAction(ActionEvent evt) {//GEN-FIRST:event_spawnObjectAction
        String cmd = evt.getActionCommand();
        char c = cmd.charAt(0);
        SceneObject o = new SceneObject(), src = null;
        if (c == 'c') {
            src = sceneCanvas.getSelectedObject();
        } else if (c == 'n') {
            ArrayList<String> spawnList = new ArrayList<String>();
            spawnList.add("Empty hitbox");
            for (SceneObject s : Project.getProject().getGalleryObjects()) {
                spawnList.add(s.toString());
            }
            spawnList.remove(1); //remove PLAYER gallery object
            Object selection = JOptionPane.showInputDialog(this, "Choose a gallery object to spawn:", "Spawn new object...",
                    JOptionPane.PLAIN_MESSAGE, null, spawnList.toArray(), null);
            if (selection == null) {
                return;
            }
            if ("Empty hitbox".equals(selection)) {
                o.setHitbox(true);
                o.autoName("hitbox", Project.getProject().getCurrentLevel());
            } else {
                src = Project.getProject().getGalleryObject((String) selection);
            }
        }

        if (src != null) {
            src.copyTo(o, false, false);
            o.autoName(src.toString(), Project.getProject().getCurrentLevel());
        }

        o.setWorldX((int) sceneCanvas.getCameraX());
        o.setWorldY((int) sceneCanvas.getCameraY());
        Project.getProject().getCurrentLevel().add(o);

        sceneCanvas.repaint();
        System.out.println("Added new object: " + o.getName());
    }//GEN-LAST:event_spawnObjectAction

    private void moveZAction(ActionEvent evt) {//GEN-FIRST:event_moveZAction
        char c = evt.getActionCommand().charAt(0);
        if (sceneCanvas.getSelectedObject() != null) {
            if (c == 'f') {
                Project.getProject().getCurrentLevel().moveForward(sceneCanvas.getSelectedObject());
            }
            if (c == 'b') {
                Project.getProject().getCurrentLevel().moveBackward(sceneCanvas.getSelectedObject());
            }
            sceneCanvas.repaint();
        }
    }//GEN-LAST:event_moveZAction

    private void topColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_topColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the top background color...", Project.getProject().getCurrentLevel().getTopBGColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setTopBGColor(c);
        }
    }//GEN-LAST:event_topColorMenuItemActionPerformed

    private void bottomColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_bottomColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the bottom background color...", Project.getProject().getCurrentLevel().getBottomBGColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setBottomBGColor(c);
        }
    }//GEN-LAST:event_bottomColorMenuItemActionPerformed

    private void lightingColorMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_lightingColorMenuItemActionPerformed
        Color c = JColorChooser.showDialog(this, "Choose the lighting color...", Project.getProject().getCurrentLevel().getLightingColor());
        if (c != null) {
            Project.getProject().getCurrentLevel().setLightingColor(c);
        }
    }//GEN-LAST:event_lightingColorMenuItemActionPerformed

    private void jMenuItem3ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem3ActionPerformed
        String input = JOptionPane.showInputDialog(this, "Ambient light intensity:", "Set lighting intensity...", JOptionPane.PLAIN_MESSAGE);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length > 0) {
            double percent = (double) parsed[0] / 100d;
            Project.getProject().getCurrentLevel().setLightingIntensity(percent);
        }
    }//GEN-LAST:event_jMenuItem3ActionPerformed

    private void spawnMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_spawnMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Coordinates:", "Set player spawn...", JOptionPane.PLAIN_MESSAGE);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 2) {
            Project.getProject().getCurrentLevel().setPlayerSpawn(parsed[0], parsed[1]);
        }
    }//GEN-LAST:event_spawnMenuItemActionPerformed

    private void cameraLocationMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_cameraLocationMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Coordinates:", "Set camera location...", JOptionPane.PLAIN_MESSAGE);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 2) {
            Project.getProject().getCurrentLevel().setCameraSpawn(parsed[0], parsed[1]);
        }
    }//GEN-LAST:event_cameraLocationMenuItemActionPerformed

    private void selectBGMusicActionPerformed(ActionEvent evt) {//GEN-FIRST:event_selectBGMusicActionPerformed
        String input = JOptionPane.showInputDialog(this, "Set background music...",
                Project.getProject().getCurrentLevel().getBGMusic());
        if (input != null) {
            Project.getProject().getCurrentLevel().setBGMusic(input);
        }
    }//GEN-LAST:event_selectBGMusicActionPerformed

    private void selectAmbienceMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_selectAmbienceMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Set ambient sound...",
                Project.getProject().getCurrentLevel().getAmbientSound());
        if (input != null) {
            Project.getProject().getCurrentLevel().setAmbientSound(input);
        }
    }//GEN-LAST:event_selectAmbienceMenuItemActionPerformed

    private void loopBGMusicMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_loopBGMusicMenuItemActionPerformed
        Project.getProject().getCurrentLevel().loopBGMusic(loopBGMusicMenuItem.isSelected());
    }//GEN-LAST:event_loopBGMusicMenuItemActionPerformed

    private void autoplayBGMusicMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_autoplayBGMusicMenuItemActionPerformed
        Project.getProject().getCurrentLevel().autoPlayBGMusic(autoplayBGMusicMenuItem.isSelected());
    }//GEN-LAST:event_autoplayBGMusicMenuItemActionPerformed

    private void loopAmbientSoundMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_loopAmbientSoundMenuItemActionPerformed
        Project.getProject().getCurrentLevel().loopBGAmbience(loopAmbientSoundMenuItem.isSelected());
    }//GEN-LAST:event_loopAmbientSoundMenuItemActionPerformed

    private void autoplayAmbientSoundMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_autoplayAmbientSoundMenuItemActionPerformed
        Project.getProject().getCurrentLevel().autoPlayBGAmbience(autoplayAmbientSoundMenuItem.isSelected());
    }//GEN-LAST:event_autoplayAmbientSoundMenuItemActionPerformed

    private void playButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_playButtonActionPerformed
        runProject(startAtCurrentLevelCheckBox.isSelected()
                ? Project.getProject().getCurrentLevel().getName() : null);
    }//GEN-LAST:event_playButtonActionPerformed

    private void levelBoundsMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_levelBoundsMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Bounds:", "Set level bounds...", JOptionPane.PLAIN_MESSAGE);
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 4) {
            Project.getProject().getCurrentLevel()
                    .setBounds(parsed[0], parsed[1], parsed[2], parsed[3]);
        }
    }//GEN-LAST:event_levelBoundsMenuItemActionPerformed

    private void jCheckBox1ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jCheckBox1ActionPerformed
        sceneCanvas.setShowGrid(jCheckBox1.isSelected());
        sceneCanvas.repaint();
    }//GEN-LAST:event_jCheckBox1ActionPerformed

    private void deleteObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteObjectButtonActionPerformed
        Project.getProject().getCurrentLevel().removeObject(sceneCanvas.getSelectedObject());
        sceneCanvas.repaint();
    }//GEN-LAST:event_deleteObjectButtonActionPerformed

    private void changeObjectProperty(ActionEvent evt) {//GEN-FIRST:event_changeObjectProperty
        char cmd = evt.getActionCommand().charAt(0);
        String input = JOptionPane.showInputDialog(objectEditor,
                cmd == 'c' ? "Type: " : (cmd == 'n' ? "Name:" : "Texture:"),
                sceneCanvas.getActiveObject().getTexture());
        if (input == null) {
            return;
        }
        boolean gallery = Project.getProject().containsGalleryObject(input);
        boolean level = Project.getProject().getCurrentLevel().containsObject(input);
        if ((cmd == 'c' && gallery) || (cmd == 'n' && level)) {
            JOptionPane.showMessageDialog(objectEditor, "This name is already taken!",
                    "Whoops!", JOptionPane.PLAIN_MESSAGE, null);
            return;
        }
        if (cmd == 'c') {
            sceneCanvas.getActiveObject().setType(input);
        }
        if (cmd == 'n') {
            sceneCanvas.getActiveObject().setName(input);
        }
        if (cmd == 't') {
            sceneCanvas.getActiveObject().setTexture(input);
        }
        GUI.refreshBasicObjectOptions();
    }//GEN-LAST:event_changeObjectProperty

    private void newAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newAnimationButtonActionPerformed
        sceneCanvas.getActiveObject().newAnimation();
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
        animationChooser.setSelectedIndex(sceneCanvas.getActiveObject().getAnimations().size() - 1);
    }//GEN-LAST:event_newAnimationButtonActionPerformed

    private void deleteAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteAnimationButtonActionPerformed
        sceneCanvas.getActiveObject().getAnimations().remove(animationChooser.getSelectedIndex());
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
    }//GEN-LAST:event_deleteAnimationButtonActionPerformed

    private void jMenuItem1ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
        String input = JOptionPane.showInputDialog(this, "Camera zoom (1x - 8x):", Project.getProject().getCurrentLevel().getZoom());
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setZoom(parsed[0]);
        }
    }//GEN-LAST:event_jMenuItem1ActionPerformed

    private void musicVolumeMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_musicVolumeMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Volume (%):",
                (int) (Project.getProject().getCurrentLevel().getBGMusicVolume() * 100));
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setBGMusicVolume(parsed[0] / 100f);
        }
    }//GEN-LAST:event_musicVolumeMenuItemActionPerformed

    private void ambientSoundVolumeMenuItemActionPerformed(ActionEvent evt) {//GEN-FIRST:event_ambientSoundVolumeMenuItemActionPerformed
        String input = JOptionPane.showInputDialog(this, "Volume (%):",
                (int) (Project.getProject().getCurrentLevel().getBGMusicVolume() * 100));
        int[] parsed = MiscMath.toIntArray(input);
        if (parsed.length >= 1) {
            Project.getProject().getCurrentLevel().setBGAmbienceVolume(parsed[0] / 100f);
        }
    }//GEN-LAST:event_ambientSoundVolumeMenuItemActionPerformed

    private void objectEditorWindowClosing(WindowEvent evt) {//GEN-FIRST:event_objectEditorWindowClosing
        hideObjectEditor();
        Project.getProject().applyGalleryChanges(sceneCanvas.getActiveObject());
    }//GEN-LAST:event_objectEditorWindowClosing

    private void sceneCanvasPropertyChange(PropertyChangeEvent evt) {//GEN-FIRST:event_sceneCanvasPropertyChange
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }//GEN-LAST:event_sceneCanvasPropertyChange

    private void galleryObjectChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_galleryObjectChooserActionPerformed
        int index = galleryObjectChooser.getSelectedIndex();
        deleteGalleryObjectButton.setEnabled(index > 0);
        if (index < 0) return;
        sceneCanvas.setActiveObject(
                Project.getProject().getGalleryObject(index));
        refreshObjectEditor();
        objectEditorTabs.setSelectedIndex(0);
    }//GEN-LAST:event_galleryObjectChooserActionPerformed

    private void newGalleryObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_newGalleryObjectButtonActionPerformed
        String input = JOptionPane.showInputDialog(objectEditor, "Name:", "New gallery object...", JOptionPane.PLAIN_MESSAGE);
        if (input == null) return;
        input = input.replaceAll("[\\/.,!@#$%^&*()_+]", "");
        SceneObject o = new SceneObject();
        o.setType(input);
        Project.getProject().addGalleryObject(o);
        GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        galleryObjectChooser.setSelectedIndex(Project.getProject().getGalleryObjects().size() - 1);
        sceneCanvas.setActiveObject(o);
        refreshObjectEditor();
    }//GEN-LAST:event_newGalleryObjectButtonActionPerformed

    private void deleteGalleryObjectButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_deleteGalleryObjectButtonActionPerformed
        Project.getProject().removeGalleryObject(galleryObjectChooser.getSelectedIndex());
        GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        sceneCanvas.setActiveObject(Project.getProject().getGalleryObject(galleryObjectChooser.getSelectedIndex()));
        refreshObjectEditor();
    }//GEN-LAST:event_deleteGalleryObjectButtonActionPerformed

    private void sceneCanvasPropertyChange1(PropertyChangeEvent evt) {//GEN-FIRST:event_sceneCanvasPropertyChange1
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }//GEN-LAST:event_sceneCanvasPropertyChange1

    private void renameAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_renameAnimationButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        String input = JOptionPane.showInputDialog(objectEditor, "Name:", a.getName());
        if (input == null) return;
        if (sceneCanvas.getActiveObject().containsAnimation(input)) {
            JOptionPane.showMessageDialog(objectEditor, "An animation already exists by that name!", "Whoops!", JOptionPane.ERROR_MESSAGE);
            return;
        }
        a.setName(input);
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
    }//GEN-LAST:event_renameAnimationButtonActionPerformed

    private void animationSpriteButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationSpriteButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        String input = JOptionPane.showInputDialog(objectEditor, "Spritesheet:", a.getSpriteSheet());
        if (input == null) return;
        a.setSpriteSheet(input);
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationSpriteButtonActionPerformed

    private void animationSpeedButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationSpeedButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        String input = JOptionPane.showInputDialog(objectEditor, "Frame duration (ms):", a.getFrameDuration());
        if (input == null) return;
        a.setFrameDuration(Integer.parseInt(input));
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationSpeedButtonActionPerformed

    private void playAnimationButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_playAnimationButtonActionPerformed
        animationCanvas.reset();
        animationCanvas.setPaused(!playAnimationButton.isSelected());
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_playAnimationButtonActionPerformed

    private void animationChooserActionPerformed(ActionEvent evt) {//GEN-FIRST:event_animationChooserActionPerformed
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_animationChooserActionPerformed

    private void addFrameButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_addFrameButtonActionPerformed
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        a.addFrameCount(Integer.parseInt(evt.getActionCommand()));
        GUI.refreshAnimationOptions();
    }//GEN-LAST:event_addFrameButtonActionPerformed

    private void lockTextureButtonActionPerformed(ActionEvent evt) {//GEN-FIRST:event_lockTextureButtonActionPerformed
        char cmd = evt.getActionCommand().charAt(0);
        JToggleButton source = (JToggleButton)evt.getSource();
        if (cmd == 'a') {
            Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
            a.setLocked(source.isSelected());
        } else {
            sceneCanvas.getActiveObject().setLocked(Integer.parseInt(cmd+""), source.isSelected());
        }
    }//GEN-LAST:event_lockTextureButtonActionPerformed

    private void jMenuItem4ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem4ActionPerformed
        try {
            java.awt.Desktop.getDesktop().browse(new URI("http://computerology.bitbucket.io"));
        } catch (URISyntaxException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IOException ex) {
            Logger.getLogger(GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jMenuItem4ActionPerformed

    private void jMenuItem6ActionPerformed(ActionEvent evt) {//GEN-FIRST:event_jMenuItem6ActionPerformed
        UpdateManager.checkForUpdates();
        if (UpdateManager.editorUpdate()) {
            JOptionPane.showMessageDialog(window, "A newer version of the level editor has been found!"
                + "\nGo to 'Help â†’ Visit website' to download it.");
        }
    }//GEN-LAST:event_jMenuItem6ActionPerformed

    /**
     * Returns 0 if user made a YES or NO choice. 1 if the user canceled.
     *
     * @return An int.
     */
    public int promptSave() {
        int dialogResult = JOptionPane.showConfirmDialog(this, "Would you like to save your progress?", "Hold on a second...",
                JOptionPane.YES_NO_CANCEL_OPTION);
        if (dialogResult == JOptionPane.CLOSED_OPTION) {
            dialogResult = JOptionPane.CANCEL_OPTION;
        }
        if (dialogResult == JOptionPane.YES_OPTION) {
            Project.getProject().save();
        }
        if (dialogResult != JOptionPane.CANCEL_OPTION) {
            return 0;
        } else {
            return 1;
        }
    }

    public static SceneCanvas getSceneCanvas() {
        return sceneCanvas;
    }

    public static AnimationCanvas getAnimationCanvas() {
        return animationCanvas;
    }

    public static void showDialog(JDialog d) {
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        double width = screenSize.getWidth();
        double height = screenSize.getHeight();
        d.setLocation((int) (width / 2) - (d.getWidth() / 2),
                (int) (height / 2) - ((d.getHeight() / 2)));
        d.setModal(true);
        d.setModalityType(Dialog.ModalityType.APPLICATION_MODAL);
        d.setVisible(true);
        System.out.println("Showing " + d.getTitle());
    }

    public void showObjectEditor() {
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        double width = screenSize.getWidth();
        double height = screenSize.getHeight();
        JFrame d = objectEditor;
        d.setSize(d.getPreferredSize());
        d.setLocation((int) (width / 2) - (d.getWidth() / 2),
                (int) (height / 2) - ((d.getHeight() / 2)));
        d.setVisible(true);
        this.setEnabled(false);
        if (Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject())) {
            GUI.refreshChooser(galleryObjectChooser, Project.getProject().getGalleryObjects());
        }
        objectEditorTabs.setSelectedIndex(0);
        System.out.println("Showing " + d.getTitle());
    }
    
    public void hideObjectEditor() {
        JFrame d = objectEditor;
        d.setVisible(false);
        this.setEnabled(true);
        this.setVisible(true);
        System.out.println("Hiding " + d.getTitle());
    }

    public static void hideDialog(JDialog d) {
        d.setVisible(false);
        d.setModal(false);
        System.out.println("Hiding " + d.getTitle());
    }

    /**
     * Clear and populate the JList with the contents of the ArrayList. Calls
     * adds toString() of each element to the JList.
     *
     * @param l The JList to refresh.
     * @param arr The list.
     */
    public static void refreshList(JList l, ArrayList arr) {
        int index = l.getSelectedIndex();
        String[] list = new String[arr.size()];
        for (int i = 0; i < arr.size(); i++) {
            list[i] = arr.get(i).toString();
        }
        l.setListData(list);
        if (index >= arr.size()) index = arr.size() - 1;
        if (index < 0) index = 0;
        if (index < 0 && arr.size() > 0) index = 0;
        l.setSelectedIndex(index);
    }
    
    public static void refreshChooser(JComboBox l, ArrayList arr) {
        int index = l.getSelectedIndex();
        l.removeAllItems();
        for (int i = 0; i < arr.size(); i++) l.addItem(arr.get(i).toString());
        if (index >= arr.size()) index = arr.size() - 1;
        if (index < 0 && arr.size() > 0) index = 0;
        l.setSelectedIndex(index);
    }

    public static void updateWindowTitle() {
        if (window == null) return;
        String title = "PlatformR Engine "+UpdateManager.VERSION_NAME+" - ";
        title += "/" + Project.getProject().getName();
        if (Project.getProject().getCurrentLevel() != null) {
            title += "/" + Project.getProject().getCurrentLevel().getName();
        }
        window.setTitle(title);
    }

    public static void refreshObjectEditor() {
        
        if (sceneCanvas.getActiveObject() == null) return;

        /**
         * GENERAL EDITOR STUFF
         */
        objectEditor.setTitle("Editing \"" + sceneCanvas.getActiveObject() + "\"");
        galleryObjectPanel.setVisible(Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject()));
        deleteGalleryObjectButton.setEnabled(galleryObjectChooser.getSelectedIndex() > 0);
        
        /**
         * TABS
         */
        refreshBasicObjectOptions();
        GUI.refreshChooser(animationChooser, sceneCanvas.getActiveObject().getAnimations());
        //GUI.refreshChooser(flowChooser, sceneCanvas.getActiveObject().getFlows());
        
        objectEditorTabs.setEnabledAt(2, !sceneCanvas.getActiveObject().isHitbox()); //animation tab
        
    }
    
    public static void refreshBasicObjectOptions() {
        objectTypeField.setText(sceneCanvas.getActiveObject().getType());
        objectTextureField.setText(sceneCanvas.getActiveObject().getTexture());
        objectNameField.setText(sceneCanvas.getActiveObject().getName());
        objectGravityCheckbox.setSelected(sceneCanvas.getActiveObject().gravity());
        objectCollidesCheckbox.setSelected(sceneCanvas.getActiveObject().collides());
        changeObjectTypeButton.setEnabled(Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject())
                && !"Player".equals(sceneCanvas.getActiveObject().getType()));
        changeObjectNameButton.setEnabled(!Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject()));
        changeObjectTextureButton.setEnabled(!sceneCanvas.getActiveObject().isHitbox());
        sceneObjectCanvas.repaint();
        
        boolean gallery = Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject());
        boolean hitbox = sceneCanvas.getActiveObject().isHitbox();
        lockTextureButton.setEnabled(!gallery && !hitbox);
        lockGravityButton.setEnabled(!gallery && !hitbox);
        lockCollidesButton.setEnabled(!gallery && !hitbox);
        lockTextureButton.setSelected(sceneCanvas.getActiveObject().isLocked(0));
        lockGravityButton.setSelected(sceneCanvas.getActiveObject().isLocked(1));
        lockCollidesButton.setSelected(sceneCanvas.getActiveObject().isLocked(2));
        
    }
    
    public static void refreshAnimationOptions() {
        boolean inbound = animationChooser.getSelectedIndex() > -1;
        boolean gallery = Project.getProject().containsGalleryObject(sceneCanvas.getActiveObject());
        boolean hitbox = sceneCanvas.getActiveObject().isHitbox();
        deleteAnimationButton.setEnabled(inbound);
        renameAnimationButton.setEnabled(inbound);
        animationSpriteButton.setEnabled(inbound);
        animationSpeedButton.setEnabled(inbound);
        addFrameButton.setEnabled(inbound);
        playAnimationButton.setEnabled(inbound);
        lockAnimationButton.setEnabled(inbound && !gallery && !hitbox);
        lockAnimationButton.setSelected(false);
        
        if (animationChooser.getSelectedIndex() < 0) {
            animationCanvas.clearAnimation();
            return;
        }
        Animation a = sceneCanvas.getActiveObject().getAnimations().get(animationChooser.getSelectedIndex());
        lockAnimationButton.setSelected(a.isLocked());
        removeFrameButton.setEnabled(a.frameCount() > 0 && inbound);
        frameCountLabel.setText("Frame count: "+a.frameCount());
        removeFrameButton.setEnabled(a.frameCount() > 1);
        animationCanvas.setAnimation(a);
        animationCanvas.reset();
        animationCanvas.repaint();
    }

    public static void refreshFlowOptions() {
        flowCanvas.repaint();
    }

    public static void refreshLevelMenu() {
        Level current = Project.getProject().getCurrentLevel();
        loopAmbientSoundMenuItem.setSelected(current.loopBGAmbience());
        loopBGMusicMenuItem.setSelected(current.loopBGMusic());
        autoplayAmbientSoundMenuItem.setSelected(current.autoPlayBGAmbience());
        autoplayBGMusicMenuItem.setSelected(current.autoPlayBGMusic());
        sceneCanvas.repaint();
    }

    public static void refreshObjectProperties() {
        objectLayerChooser.setEnabled(sceneCanvas.getSelectedObject() != null);
        objectLayerChooser.setSelectedIndex(sceneCanvas.getSelectedObject() != null
                ? sceneCanvas.getSelectedObject().getLayer() - 1 : -1);
        bringForwardButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        sendBackwardsButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        cloneObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        editObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
        deleteObjectButton.setEnabled(sceneCanvas.getSelectedObject() != null);
    }

    public void runProject(String level_name) {
        UpdateManager.checkForUpdates();
        
        if (UpdateManager.runtimeUpdate()) {
            JOptionPane.showMessageDialog(this, "Your game files are being updated!"
                    + "\nWhen complete, you can run your project.");
            if (!UpdateManager.downloadInProgress()) UpdateManager.downloadRuntime();
            return;
        } else {
            if (UpdateManager.editorUpdate()) {
                JOptionPane.showMessageDialog(this, "An update is available for your editor!"
                    + "\nIf you have any issues with this test, try downloading it\n"
                        + "via the Help menu.");
            }
        }
        
        try {
            //Scene.DOWNLOAD_THREAD.download("https://computerology.bitbucket.io/index.html", "C:/Users/Jeremy/Desktop/index.html");
            GUI.statusIndicator.setText("Starting game...");
            //start the runtime jar and pass in the project directory and the name of the level to start in
            //you will need to update this in the runtime jar when you reach that point

            String cmd = "java -jar \"" + Assets.USER_HOME + "/platformr/jars/runtime.jar\" \"" + Project.getProject().getDirectory() + "\""
                    + (level_name != null ? " \"" + level_name + "\"" : "");
            System.out.println(cmd);

            Process p = Runtime.getRuntime()
                    .exec(cmd);
            BufferedReader reader
                    = new BufferedReader(new InputStreamReader(p.getInputStream()));
            window.setVisible(false);
            //log the runtime's output
            System.out.println("---START OF GAME OUTPUT---");
            String results = "";
            String line = "";
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
                results += line + "\n";
            }
            System.out.println("---END OF GAME OUTPUT---");
            resultsTextBox.setText(results);
            showDialog(testOutputDialog);
            window.setVisible(true);
            GUI.statusIndicator.setText("");
        } catch (IOException ex) {
            //Logger.getLogger(GUI.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        try {
            // select Look and Feel
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (Exception ex) {
            ex.printStackTrace();
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {

                window = new GUI();
                window.setVisible(true);
                window.setExtendedState(java.awt.Frame.MAXIMIZED_BOTH);
                
                galleryObjectPanel.setVisible(false);

                Assets.mkdirs();
                Project.newProject("", true, true);
                Project.getProject().autoName();
                Assets.load();
                
                UpdateManager.checkForUpdates();
                if (UpdateManager.editorUpdate()) {
                    JOptionPane.showMessageDialog(window, "A newer version of the level editor has been found!"
                        + "\nGo to 'Help â†’ Visit website' to download it.");
                }
                if (UpdateManager.runtimeUpdate()) {
                    UpdateManager.downloadRuntime();
                }

                updateWindowTitle();
                sceneCanvas.repaint();

                JOptionPane.showMessageDialog(window, "Welcome, " + System.getProperty("user.name") + "!\n"
                        + "A blank project has been created for you. You can load previous\n"
                        + "projects using the Project menu.\n");

            }
        });

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private static JButton addFrameButton;
    JMenuItem ambientSoundVolumeMenuItem;
    private static AnimationCanvas animationCanvas;
    private static JComboBox<String> animationChooser;
    private static JButton animationSpeedButton;
    private static JButton animationSpriteButton;
    private static JCheckBoxMenuItem autoplayAmbientSoundMenuItem;
    private static JCheckBoxMenuItem autoplayBGMusicMenuItem;
    JPanel basicOptionsPanel;
    JMenuItem bottomColorMenuItem;
    public static JButton bringForwardButton;
    JMenuItem cameraLocationMenuItem;
    private static JButton changeObjectNameButton;
    private static JButton changeObjectTextureButton;
    private static JButton changeObjectTypeButton;
    public static JButton cloneObjectButton;
    private static JButton deleteAnimationButton;
    private static JButton deleteGalleryObjectButton;
    JButton deleteLevelButton;
    private static JButton deleteObjectButton;
    JButton editLevelButton;
    public static JButton editObjectButton;
    JMenu fileMenu;
    private static FlowCanvas flowCanvas;
    private static JLabel frameCountLabel;
    private static JComboBox<String> galleryObjectChooser;
    private static JPanel galleryObjectPanel;
    JCheckBox jCheckBox1;
    JLabel jLabel1;
    JLabel jLabel2;
    JLabel jLabel21;
    JLabel jLabel3;
    JLabel jLabel4;
    JMenu jMenu1;
    JMenu jMenu2;
    JMenu jMenu3;
    JMenuItem jMenuItem1;
    JMenuItem jMenuItem2;
    JMenuItem jMenuItem3;
    JMenuItem jMenuItem4;
    JMenuItem jMenuItem5;
    JMenuItem jMenuItem6;
    JMenuItem jMenuItem8;
    JMenuItem jMenuItem9;
    JPanel jPanel13;
    JPanel jPanel5;
    JPanel jPanel6;
    JPanel jPanel8;
    JScrollPane jScrollPane12;
    JScrollPane jScrollPane9;
    JPopupMenu.Separator jSeparator4;
    JPopupMenu.Separator jSeparator5;
    JPopupMenu.Separator jSeparator6;
    JMenuItem levelBoundsMenuItem;
    private static JList levelList;
    JMenuItem levelManagerButton;
    public static JDialog levelManagerDialog;
    JMenu levelMenu;
    JTextField levelNameField;
    JMenuItem lightingColorMenuItem;
    private static JToggleButton lockAnimationButton;
    private static JToggleButton lockCollidesButton;
    private static JToggleButton lockGravityButton;
    private static JToggleButton lockTextureButton;
    private static JCheckBoxMenuItem loopAmbientSoundMenuItem;
    private static JCheckBoxMenuItem loopBGMusicMenuItem;
    public static JMenuBar menuBar;
    JMenuItem musicVolumeMenuItem;
    private static JButton newAnimationButton;
    private static JButton newGalleryObjectButton;
    JMenuItem newLevelButton;
    public static JButton newObjectButton;
    JMenuItem newProjectButton;
    private static JCheckBox objectCollidesCheckbox;
    private static JFrame objectEditor;
    private static JTabbedPane objectEditorTabs;
    JMenuItem objectGalleryButton;
    private static JCheckBox objectGravityCheckbox;
    public static JComboBox objectLayerChooser;
    private static JTextField objectNameField;
    private static JTextField objectTextureField;
    private static JTextField objectTypeField;
    JMenuItem openAssetsFolderButton;
    JMenuItem openProjectButton;
    private static JToggleButton playAnimationButton;
    public static JButton playButton;
    JMenu projectMenu;
    JMenuItem reloadAssetsButton;
    private static JButton removeFrameButton;
    private static JButton renameAnimationButton;
    JButton renameLevelButton;
    private static JTextArea resultsTextBox;
    JMenuItem saveProjectButton;
    public static SceneCanvas sceneCanvas;
    private static SceneObjectCanvas sceneObjectCanvas;
    JMenuItem selectAmbienceMenuItem;
    JMenuItem selectBGMusic;
    public static JButton sendBackwardsButton;
    JMenuItem spawnMenuItem;
    public static JCheckBox startAtCurrentLevelCheckBox;
    public static JMenu statusIndicator;
    public static JDialog testOutputDialog;
    JMenuItem topColorMenuItem;
    JPanel topPanel;
    JMenuItem viewRootButton;
    // End of variables declaration//GEN-END:variables
}
